;*
================================================================================

    extracted_0001.hsc, file 2 of 2

    generated by Invader 0.54.2.r4101

================================================================================
*;

(script dormant m_return_cliffs_canyon
    (sleep_until
        (or
            (volume_test_players_any override_pool_enter_side)
            (volume_test_players_any override_pool_enter_back)
            (volume_test_players_any ext_canyon_main)
            (volume_test_players_any override_cliffs_smartass)
        )
        1
    )
    (ai_place return_cliffs_canyon)
    (set m_return_cliffs_canyon_start 1)
    (game_save_no_timeout)
    (sleep_until
        (or
            (< (ai_living_count return_pool/pool_elite_left) 1)
            (< (ai_living_count return_pool/pool_elite_right) 1)
            (volume_test_players_any override_pool_approach)
        )
        1
    )
    (game_save_no_timeout)
    (ai_migrate return_pool/back return_cliffs_canyon/pool_elites_retreat)
    (ai_magically_see_players return_cliffs_canyon)
    (ai_magically_see_players return_cliffs_canyon_c)
    (sleep_until (volume_test_players_any override_cliffs_path_end) 1)
    (ai_defend return_cliffs_canyon)
    (ai_defend return_cliffs_canyon_c)
    (sleep_until
        (or
            (volume_test_players_any override_cliffs_arch_path)
            (volume_test_players_any override_cliffs_side_path)
        )
        1
    )
    (ai_migrate return_cliffs_canyon_c/pool_elites_retreat return_cliffs_canyon_c/canyon_elite_ground_low)
    (ai_migrate return_cliffs_canyon_c/canyon_elite_ground_high return_cliffs_canyon_c/canyon_elite_ridge_low)
    (ai_migrate return_cliffs_canyon_c/canyon_elite_ridge_high return_cliffs_canyon_c/canyon_elite_ground_low)
    (ai_migrate return_cliffs_canyon_c/canyon_grunts_mid return_cliffs_canyon_c/canyon_grunts_low)
    (if
        (volume_test_players_any override_cliffs_arch_path)
        (begin
            (ai_attack return_cliffs_canyon)
            (ai_attack return_cliffs_canyon_c)
            (print_debug "player moved through arch; units intercepting")
        )
        (begin
            (ai_defend return_cliffs_canyon)
            (ai_defend return_cliffs_canyon_c)
            (print_debug "player moved through side; units falling back")
        )
    )
)


(script dormant m_return_cliffs_bowl
    (sleep_until
        (or
            (volume_test_players_any override_cliffs_cliff_mid)
            (volume_test_players_any override_cliffs_arch_path)
            (volume_test_players_any override_cliffs_side_path)
        )
        1
    )
    (ai_place return_cliffs_bowl)
    (game_save_no_timeout)
    (ai_migrate return_cliffs_canyon/low return_cliffs_bowl/canyon_retreat)
    (ai_migrate return_cliffs_canyon_c/low return_cliffs_bowl/canyon_retreat)
    (ai_magically_see_players return_cliffs_bowl)
    (sleep_until (volume_test_players_any override_cliffs_path_bowl))
    (game_save_no_timeout)
    (ai_defend return_cliffs_bowl)
    (sleep_until
        (or
            (volume_test_players_any override_cliffs_path_nook)
            (volume_test_players_any override_cliffs_path_jump)
        )
        1
    )
    (ai_migrate return_cliffs_bowl return_cliffs_bowl/bowl_exit)
    (game_save_no_timeout)
)


(script dormant m_return_cliffs_fodder
    (sleep_until
        (or
            (volume_test_players_any override_cliffs_path_bowl)
            (volume_test_players_any ext_cart_smallgorge)
        )
        1
    )
    (game_save_no_timeout)
    (ai_place return_cliffs_fodder)
    (ai_go_to_vehicle return_cliffs_fodder/fodder_grunts return_cliffs_turret gunner)
    (sleep_until (volume_test_players_any override_cliffs_entrance))
    (ai_go_to_vehicle return_cliffs_fodder return_cliffs_turret gunner)
    (game_save_no_timeout)
    (sleep_until
        (or
            (> 0.250000 (ai_living_fraction return_cliffs_fodder))
            (volume_test_players_any ext_cart_smallgorge)
            (volume_test_players_any ext_canyon_main)
        )
    )
    (game_save_no_timeout)
)


(script static void m_return_cliffs_startup
    (print_debug m_return_cliffs_startup)
    (wake m_return_cliffs_pool)
    (wake m_return_cliffs_canyon)
    (wake m_return_cliffs_bowl)
    (wake m_return_cliffs_fodder)
    (wake m_return_cliffs_music)
    (set m_return_cliffs_music_started 1)
    (object_create_containing return_cliffs)
)


(script static void m_return_cliffs_cleanup
    (print_debug m_return_cliffs_cleanup)
    (sleep -1 m_return_cliffs_pool)
    (sleep -1 m_return_cliffs_canyon)
    (sleep -1 m_return_cliffs_bowl)
    (sleep -1 m_return_cliffs_fodder)
    (sleep -1 m_return_cliffs_canyon_automig)
    (sleep -1 m_return_cliffs_music)
    (sleep -1 m_return_cliffs_music_fucker)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_10_return_sneaky)
    (ai_erase return_pool)
    (ai_erase return_cliffs_canyon)
    (ai_erase return_cliffs_canyon_c)
    (ai_erase return_cliffs_bowl)
    (ai_erase return_cliffs_fodder)
)


(script dormant m_return_cart_combat_beginner
    (sleep_until
        (or
            (>= 4 (ai_status return_cart_field))
            (>= 4 (ai_status return_cart_entrance))
        )
    )
    (set m_return_cart_combat_begun 1)
    (if
        (not (game_is_easy))
        (object_create magic_shotgun)
    )
    (game_save_no_timeout)
)


(script dormant return_cart_field_triggerer
    (sleep_until m_return_cart_combat_begun)
    (sleep_until
        (begin (ai_magically_see_players return_cart_field/snipers) 0)
    )
)


(script continuous return_cart_hunters_updater
    (sleep_until return_cart_hunters_start 1)
    (if
        (or
            (volume_test_players_any ext_cart_entrance_past)
            (volume_test_players_any ext_cart_entrance_top)
            (volume_test_players_any ext_cart_secret_inside)
        )
        (ai_migrate return_cart_entrance/hunters return_cart_entrance/hunters_defending)
        (if
            (or
                (volume_test_players_any ext_cart_platform_left)
                (volume_test_players_any ext_cart_platform_right)
                (volume_test_players_any ext_cart_entrance)
            )
            (ai_migrate return_cart_entrance/hunters return_cart_entrance/hunters_pursuing)
        )
    )
    (if
        (volume_test_players_all ext_cart_side_right)
        (ai_migrate return_cart_entrance/hunters return_cart_entrance/hunters_pursuing_right)
    )
    (if
        (volume_test_players_all ext_cart_side_left)
        (ai_migrate return_cart_entrance/hunters return_cart_entrance/hunters_pursuing_left)
    )
)


(script dormant return_cart_hunters_triggerer
    (sleep_until
        (or
            (<= 3 (ai_living_count return_cart_entrance))
            (volume_test_players_any ext_cart_entrance_past)
        )
    )
    (ai_migrate return_cart_entrance/hunters_spawn return_cart_entrance/hunters_pursuing)
    (ai_migrate return_cart_entrance/hunters_spawn_easy return_cart_entrance/hunters_pursuing)
    (set return_cart_hunters_start 1)
    (game_save_no_timeout)
    (sleep_until
        (>= 1 (ai_living_count return_cart_entrance/hunters))
    )
    (game_save_no_timeout)
    (sleep_until
        (>= 0 (ai_living_count return_cart_entrance/hunters))
    )
    (game_save_no_timeout)
)


(script continuous return_cart_jackals_updater
    (sleep_until return_cart_jackals_start 1)
    (if
        (and
            (volume_test_players_any ext_cart_platform_left)
            (not (volume_test_players_any ext_cart_platform_right))
        )
        (ai_migrate return_cart_entrance/jackals return_cart_entrance/jackals_pursuing_left)
    )
    (if
        (and
            (volume_test_players_any ext_cart_platform_right)
            (not (volume_test_players_any ext_cart_platform_left))
        )
        (ai_migrate return_cart_entrance/jackals return_cart_entrance/jackals_pursuing_right)
    )
)


(script dormant return_cart_entrance_triggerer
    (sleep_until m_return_cart_combat_begun)
    (object_create_anew_containing return_cart_turret_)
    (ai_go_to_vehicle return_cart_entrance/fodder_grunts return_cart_turret_left gunner)
    (ai_go_to_vehicle return_cart_entrance/fodder_grunts return_cart_turret_right gunner)
    (ai_go_to_vehicle return_cart_entrance/fodder_grunts ext_cart_turret_front gunner)
    (ai_vehicle_enterable_distance return_cart_turret_left 10.000000)
    (ai_vehicle_enterable_distance return_cart_turret_right 10.000000)
    (ai_vehicle_enterable_distance ext_cart_turret_front 10.000000)
    (set return_cart_jackals_start 1)
)


(script dormant return_cart_wraith_triggerer
    (sleep_until
        (>= 0 (ai_living_count return_cart_wraith_1))
    )
    (game_save_no_timeout)
    (sleep_until
        (>= 0 (ai_living_count return_cart_wraith_2))
    )
    (game_save_no_timeout)
)


(script dormant return_cart_wdrop_triggerer
    (sleep_until
        (or
            (volume_test_players_any ext_cart_terrain_front)
            (volume_test_players_any ext_cart_side_left)
            (volume_test_players_any ext_cart_side_right)
        )
    )
    (unit_exit_vehicle return_cart_wraith_1)
    (game_save_no_timeout)
    (sleep_until m_return_cart_combat_begun)
    (ai_go_to_vehicle return_cart_field_pilots/wraith_pilot_1 return_cart_wraith_1 driver)
    (sleep 150)
    (vehicle_hover ext_cart_cship 0)
    (recording_play_and_delete ext_cart_cship return_cart_cliffs_dropoff_out)
)


(script static void m_return_cart_wraith_setup
    (sleep 15)
    (object_create_anew return_cart_wraith_1)
    (skip_frame)
    (ai_vehicle_enterable_distance return_cart_wraith_1 10.000000)
    (ai_vehicle_enterable_team return_cart_wraith_1 covenant)
    (ai_vehicle_encounter return_cart_wraith_1 return_cart_wraith_1/d)
    (ai_follow_target_players return_cart_wraith_1)
    (ai_follow_distance return_cart_wraith_1 10.000000)
    (ai_automatic_migration_target return_cart_wraith_1 1)
    (if
        (and
            (<= hard (game_difficulty_get_real))
            m_return_cart_assaulting
        )
        (begin
            (object_create_anew return_cart_wraith_2)
            (skip_frame)
            (ai_vehicle_enterable_distance return_cart_wraith_2 10.000000)
            (ai_vehicle_enterable_team return_cart_wraith_2 covenant)
            (ai_vehicle_encounter return_cart_wraith_2 return_cart_wraith_2/d)
            (ai_follow_target_players return_cart_wraith_2)
            (ai_follow_distance return_cart_wraith_2 10.000000)
            (ai_automatic_migration_target return_cart_wraith_2 1)
        )
    )
)


(script static void m_return_cart_init
    (ai_place return_cart_secret)
    (ai_place return_cart_entrance)
    (object_set_scale
        (list_get (ai_actors return_cart_entrance/hunters_spawn_easy) 0)
        0.800000
        1
    )
    (object_set_scale
        (list_get (ai_actors return_cart_entrance/hunters_spawn_easy) 1)
        0.800000
        1
    )
    (if
        (game_is_easy)
        (ai_erase return_cart_entrance/hunters_spawn)
        (ai_erase return_cart_entrance/hunters_spawn_easy)
    )
    (wake return_cart_hunters_triggerer)
    (wake return_cart_entrance_triggerer)
    (if
        (volume_test_object ext_cart_main ext_cart_bonus_ghost_1)
        (object_destroy ext_cart_bonus_ghost_1)
    )
    (if
        (volume_test_object ext_cart_main ext_cart_bonus_ghost_2)
        (object_destroy ext_cart_bonus_ghost_2)
    )
    (object_destroy_containing ext_cart_turret_front)
    (ai_place return_cart_field)
    (wake return_cart_field_triggerer)
    (ai_erase ext_cart_entrance/interior)
    (ai_erase ext_cart_entrance/ledge_left)
    (ai_erase ext_cart_entrance/ledge_right)
    (ai_erase ext_cart_field)
)


(script static void m_return_cart_init_assault
    (print_debug m_return_cart_init_assault)
    (sleep_until
        (= bsp_index_ext_cart (structure_bsp_index))
        1
    )
    (set m_return_cart_assaulting 1)
    (set m_return_cart_combat_begun 1)
    (m_return_cart_wraith_setup)
    (ai_place return_cart_field_pilots/wraith_pilot_1)
    (ai_place return_cart_field_pilots/wraith_pilot_2)
    (skip_frame)
    (unit_enter_vehicle (ai_actor return_cart_field_pilots/wraith_pilot_1 0) return_cart_wraith_1 wraith-driver)
    (unit_enter_vehicle (ai_actor return_cart_field_pilots/wraith_pilot_2 0) return_cart_wraith_2 wraith-driver)
    (ai_magically_see_players return_cart_field_pilots)
    (wake return_cart_wraith_triggerer)
)


(script static void m_return_cart_init_stealth
    (print_debug m_return_cart_init_stealth)
    (sleep_until
        (= bsp_index_ext_cart (structure_bsp_index))
        1
    )
    (wake m_return_cart_combat_beginner)
    (create_ext_cart_cship)
    (object_teleport ext_cart_cship return_cart_cliffs_dropoff_flag)
    (vehicle_hover ext_cart_cship 1)
    (ai_place return_cart_field_pilots/wraith_pilot_1)
    (m_return_cart_wraith_setup)
    (unit_enter_vehicle return_cart_wraith_1 ext_cart_cship large_cargo)
    (wake return_cart_wdrop_triggerer)
    (wake return_cart_wraith_triggerer)
)


(script dormant m_return_cart_main
    (sleep_until
        (or
            (volume_test_players_any override_cliffs_entrance)
            (volume_test_players_any ext_cart_return_approaching)
        )
        1
    )
    (print_debug "m_return_cart_start - a player has approached")
    (if
        (volume_test_players_any ext_cart_return_approaching)
        (m_return_cart_init_assault)
        (m_return_cart_init_stealth)
    )
    (m_return_cart_init)
)


(script static void m_return_cart_startup
    (print_debug m_return_cart_startup)
    (wake m_return_cart_main)
)


(script static void m_return_cart_cleanup
    (print_debug m_return_cart_cleanup)
    (ai_erase return_cart_secret)
    (ai_erase return_cart_entrance)
    (ai_erase return_cart_field)
)


(script dormant m_return_leadup_music
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_08_crash)
    (sleep_until (volume_test_players_any override_shaft_door) 30 900)
    (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_08_crash)
    (sleep_until
        (or
            (volume_test_players_any override_bridge_halfway)
            (volume_test_players_any override_cliffs_path_canyon)
        )
        30
        7200
    )
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_08_crash)
)


(script dormant m_return_pelican_crash
    (sleep 150)
    (ai_conversation downed_enter)
    (object_create joke)
    (skip_second)
    (wake m_return_leadup_music)
    (game_save_no_timeout)
    (sleep 350)
    (player_effect_explosion)
    (sound_impulse_start cmt\sounds\sfx\effects\explosions\muffled_indistinct_explosions none 1.000000)
    (object_create_containing downed)
    (object_set_permutation return_downed_pelican parts damaged)
    (object_set_permutation return_downed_pelican wind off)
    (player_effect_stop 4.000000)
    (object_destroy joke)
    (if
        (game_is_easy)
        (begin
            (object_destroy return_downed_dump_w2)
            (object_destroy return_downed_dump_w3)
            (object_destroy return_downed_dump_w4)
            (object_teleport return_downed_pelican easy_crash_flag)
            (object_teleport help_boulder help_boulder_flag)
            (object_teleport help_boulder_2 help_boulder_flag_2)
            (object_teleport help_boulder_3 help_boulder_flag_3)
            (physics_set_gravity 0.900000)
            (ai_place victims)
            (ai_command_list victims suicide)
            (phantom_of_the_map)
        )
    )
    (sleep_until (volume_test_players_any override_shaft_door))
    (game_save_no_timeout)
)


(script continuous m_return_shaft_server_updater
    (sleep_until m_return_shaft_server_start 1)
    (ai_magically_see_players return_shaft_server)
    (if
        (volume_test_players_all override_shaft_server_a)
        (begin
            (ai_migrate return_shaft_server/stealth_harass return_shaft_server/stealth_elites_harass_b)
            (ai_migrate return_shaft_server/stealth_guard return_shaft_server/stealth_elites_guard_f)
            (ai_migrate return_shaft_server/stealth_intercept return_shaft_server/stealth_elites_intercept_c)
        )
        (if
            (volume_test_players_all override_shaft_server_b)
            (begin
                (ai_migrate return_shaft_server/stealth_harass return_shaft_server/stealth_elites_harass_c)
                (ai_migrate return_shaft_server/stealth_guard return_shaft_server/stealth_elites_guard_f)
                (ai_migrate return_shaft_server/stealth_intercept return_shaft_server/stealth_elites_intercept_b)
            )
            (if
                (volume_test_players_all override_shaft_server_c)
                (begin
                    (ai_migrate return_shaft_server/stealth_harass return_shaft_server/stealth_elites_harass_d)
                    (ai_migrate return_shaft_server/stealth_guard return_shaft_server/stealth_elites_guard_g)
                    (ai_migrate return_shaft_server/stealth_intercept return_shaft_server/stealth_elites_intercept_c)
                )
                (if
                    (volume_test_players_all override_shaft_server_d)
                    (begin
                        (ai_migrate return_shaft_server/stealth_harass return_shaft_server/stealth_elites_harass_e)
                        (ai_migrate return_shaft_server/stealth_guard return_shaft_server/stealth_elites_guard_h)
                        (ai_migrate return_shaft_server/stealth_intercept return_shaft_server/stealth_elites_intercept_b)
                    )
                    (if
                        (game_is_cooperative)
                        (begin
                            (ai_migrate return_shaft_server/stealth_harass return_shaft_server/stealth_elites_harass_all)
                            (ai_migrate return_shaft_server/stealth_guard return_shaft_server/stealth_elites_guard_all)
                            (ai_migrate return_shaft_server/stealth_intercept return_shaft_server/stealth_elites_intercept_all)
                        )
                    )
                )
            )
        )
    )
)


(script continuous m_return_shaft_server_automig
    (sleep_until
        (= (structure_bsp_index) bsp_index_ext_pit)
        1
    )
    (ai_migrate return_shaft_server_pit/ground_cleanup override_pit/ground_cleanup)
    (sleep_until
        (= (structure_bsp_index) bsp_index_int_sec_servers)
        1
    )
    (ai_migrate override_pit/ground_cleanup return_shaft_server_pit/ground_cleanup)
    (ai_teleport_to_starting_location_if_unsupported return_shaft_server_pit/ground_cleanup)
)


(script dormant m_return_shaft
    (sleep_until (volume_test_players_any override_ufo_elev_bot))
    (wake m_return_pelican_crash)
    (ai_place return_shaft_corridor/catwalk)
    (ai_set_current_state override_shaft_server search)
    (sleep_until (volume_test_players_any override_shaft_door))
    (game_save_no_timeout)
    (ai_migrate return_shaft_corridor/catwalk_jackal return_shaft_corridor/catwalk_jackal_rush)
    (ai_command_list return_shaft_corridor/catwalk return_shaft_elev_catwalk_rush)
    (sleep_until (volume_test_players_any override_shaft_entrance))
    (game_save_no_timeout)
    (ai_place return_shaft_server)
    (sleep_until (volume_test_players_any override_shaft_server_d))
    (set m_return_shaft_server_start 1)
    (sleep_until
        (or
            (= 0 (ai_living_count return_shaft_server))
            (volume_test_players_any override_shaft_server_entrance)
        )
    )
    (ai_migrate return_shaft_server return_shaft_server_pit/ground_cleanup)
    (ai_command_list override_pit/ground_cleanup return_pit_ground)
    (game_save_no_timeout)
    (sleep_until
        (or
            (volume_test_players_any override_pit_right)
            (volume_test_players_any override_pit_left)
        )
    )
    (if (game_is_easy) (ai_place return_pit_inclement_weather))
    (sleep 60)
    (ai_kill return_pit_inclement_weather)
    (game_save_no_timeout)
)


(script static void m_return_launch
    (checkpoint_launch bsp_index_ext_ufo m_return_spawn_0 m_return_spawn_1)
    (cinematic_show_letterbox 1)
    (show_hud 0)
    (game_save_totally_unsafe)
    (cinematic_set_title unlocked)
    (sleep 150)
    (cinematic_show_letterbox 0)
    (show_hud 1)
)


(script static void m_return_start
    (print_debug "m_return_start: starting")
    (if
        (= b30r_launch_return mission_launch_index)
        (m_return_launch)
    )
    (if
        (game_is_easy)
        (objective_set dia_found_ez obj_found_ez)
        (if
            (>= mission_state mission_cartographer_found)
            (objective_set dia_found obj_found)
            (objective_set dia_find obj_find)
        )
    )
    (wake m_return_shaft)
    (object_create_containing cart_return_block)
    (object_destroy_containing cart_old_block)
    (ai_kill marines_ext_capp-cart)
    (sleep_until (volume_test_players_any override_pit_ground_level))
    (m_return_downed_startup)
    (m_return_cliffs_startup)
    (m_return_cart_startup)
)


(script static void m_return_clean
    (sleep -1 m_return_shaft)
    (sleep -1 m_return_shaft_server_updater)
    (sleep -1 m_return_shaft_server_automig)
    (m_return_downed_cleanup)
    (m_return_cliffs_cleanup)
    (m_return_cart_cleanup)
)


(script static void m_return_skip
    (object_create_containing downed)
    (object_create_containing cart_return_block)
    (object_destroy_containing cart_old_block)
    (object_create_containing return_cliffs)
    (object_destroy_containing ext_cart_turret_front)
)


(script dormant m_return_control
    (if
        (!= m_return_ctrl_state 1)
        (m_return_skip)
        (m_return_start)
    )
    (sleep_until (>= m_return_ctrl_state 3))
    (m_return_clean)
)


(script static void m_return_startup
    (if
        (= 0 m_return_ctrl_state)
        (begin
            (set m_return_ctrl_state 1)
            (wake m_return_control)
        )
    )
)


(script static void m_return_cleanup
    (set m_return_ctrl_state 3)
)


(script static void m_return_mark_skip
    (m_return_startup)
    (set m_return_ctrl_state 2)
)


(script static void m_int_cart_cutscene
    (fade_to_white)
    (skip_second)
    (cinematic_start)
    (ai_teleport_to_starting_location int_cart_hunters_side)
    (ai_braindead int_cart_brutes 1)
    (ai_braindead int_cart_evolved 1)
    (ai_braindead int_cart_classic 1)
    (ai_braindead int_cart_sides 1)
    (ai_braindead int_cart_hunters 1)
    (ai_braindead int_cart_hunters_side 1)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_16_cart_active)
    (show_hud 0)
    (player_enable_input 0)
    (camera_control 1)
    (teleport_players int_cart_cutscene_wait int_cart_cutscene_wait)
    (skip_frame)
    (x_cut_setup_player0 cart_cyborg_0)
    (unit_set_seat cart_cyborg_0 alert)
    (object_teleport cart_cyborg_0 int_cart_activate)
    (if
        (game_is_cooperative)
        (begin
            (x_cut_setup_player1 cart_cyborg_1)
            (unit_set_seat cart_cyborg_1 alert)
        )
    )
    (object_create_anew int_shaft_c_holo_ring)
    (camera_set int_cart_1a 0)
    (camera_set int_cart_1b 180)
    (fade_from_white)
    (skip_second)
    (device_set_position int_shaft_c_holo_ring 1.000000)
    (sound_impulse_start cmt\sounds\sfx\scenarios\b30_revamp\foley\b30r_ring_foley none 1.000000)
    (if
        (> (device_group_get position_ext_sec_security_holo) 0.000000)
        (ai_conversation int_cart_switch)
        (ai_conversation int_cart_switch_bonus)
    )
    (sleep 135)
    (camera_set int_cart_2 0)
    (sleep 145)
    (if
        (game_is_cooperative)
        (recording_play cart_cyborg_1 cart_cyborg_approach)
    )
    (sleep 15)
    (camera_set int_cart_3a 0)
    (camera_set int_cart_3b 300)
    (sleep 80)
    (custom_animation cart_cyborg_0 cmt\characters\_shared\cyborg\cinematics\animations\level_specific\b30_revamp\b30_revamp look_with_intent 0)
    (sleep 170)
    (fade_to_white)
    (skip_half_second)
    (ai_braindead int_cart_brutes 0)
    (ai_braindead int_cart_evolved 0)
    (ai_braindead int_cart_classic 0)
    (ai_braindead int_cart_sides 0)
    (ai_braindead int_cart_hunters 0)
    (ai_braindead int_cart_hunters_side 0)
    (teleport_players int_cart_cutscene_end_0 int_cart_cutscene_end_1)
    (x_cut_teardown_player0 cart_cyborg_0)
    (if (game_is_cooperative) (x_cut_teardown_player1 cart_cyborg_1))
    (cinematic_stop)
    (camera_control 0)
    (show_hud 1)
    (player_enable_input 1)
    (game_save_totally_unsafe)
    (set mission_state mission_cartographer_activated)
    (fade_from_white)
    (skip_half_second)
)


(script continuous m_int_cart_checkpoint_bastard
    (sleep_until m_int_cart_checkpoint_start 1)
    (sleep_until
        (and
            (not (game_safe_to_save))
            (volume_test_players_any int_cart_main)
        )
    )
    (sleep_until (game_safe_to_save))
    (game_save_no_timeout)
    (set m_int_cart_checkpoint_limit (- m_int_cart_checkpoint_limit 1.000000))
    (if
        (= m_int_cart_checkpoint_limit 0.000000)
        (sleep_forever)
    )
)


(script static void m_int_cart_brute_end
    (if
        (!= (bit_test m_int_cart_brute_statebits ended_bit) 1)
        (begin
            (print_debug m_int_cart_brute_end)
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits ended_bit 1))
            (sleep -1 m_int_cart_brute_updater)
            (ai_migrate int_cart_brutes/stragglers_left int_cart_sides/left_lower)
            (ai_migrate int_cart_brutes/stragglers_center int_cart_sides/left_upper)
            (ai_migrate int_cart_brutes/stragglers_right int_cart_sides/right_lower)
            (ai_migrate int_cart_brutes/stragglers_front int_cart_sides/right_upper)
        )
    )
)


(script static void m_int_cart_evolved_end
    (if
        (!= (bit_test m_int_cart_evolved_statebits ended_bit) 1)
        (begin
            (print_debug m_int_cart_evolved_end)
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits ended_bit 1))
            (sleep -1 m_int_cart_evolved_updater)
            (ai_migrate int_cart_evolved/stragglers_left int_cart_sides/left_lower)
            (ai_migrate int_cart_evolved/stragglers_center int_cart_sides/left_upper)
            (ai_migrate int_cart_evolved/stragglers_right int_cart_sides/left_lower)
            (ai_migrate int_cart_evolved/stragglers_front int_cart_sides/left_upper)
        )
    )
)


(script static void m_int_cart_classic_end
    (if
        (!= (bit_test m_int_cart_classic_statebits ended_bit) 1)
        (begin
            (print_debug m_int_cart_classic_end)
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits ended_bit 1))
            (sleep -1 m_int_cart_classic_updater)
            (ai_migrate int_cart_classic/stragglers_left int_cart_sides/right_lower)
            (ai_migrate int_cart_classic/stragglers_center int_cart_sides/right_upper)
            (ai_migrate int_cart_classic/stragglers_right int_cart_sides/right_lower)
            (ai_migrate int_cart_classic/stragglers_front int_cart_sides/right_upper)
        )
    )
)


(script static void m_int_cart_classic_rein_left
    (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits reins_l_place_bit 1))
)


(script static void m_int_cart_classic_rein_right
    (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits reins_r_place_bit 1))
)


(script static void m_int_cart_evolved_rein_left
    (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits reins_l_place_bit 1))
)


(script static void m_int_cart_evolved_rein_right
    (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits reins_r_place_bit 1))
)


(script static void m_int_cart_brute_rein_left
    (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits reins_l_place_bit 1))
)


(script static void m_int_cart_brute_rein_right
    (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits reins_r_place_bit 1))
)


(script continuous m_int_cart_classic_updater
    (sleep_until m_int_cart_classic_start 1)
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_l (volume_test_players_all int_cart_classic_left))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_r (volume_test_players_all int_cart_classic_right))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_f (volume_test_players_all int_cart_classic_front))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_c (volume_test_players_all int_cart_classic_center))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_b (volume_test_players_all int_cart_classic_back))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_u (volume_test_players_all int_cart_upper))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle
            m_int_cart_pos_statebits
            player_pos_any
            (or
                (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                (game_is_cooperative)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
        (begin
            (ai_migrate int_cart_classic/anchors_core int_cart_classic/anchors_core_left)
            (ai_migrate int_cart_classic/fodder_core int_cart_classic/fodder_core_left)
            (ai_migrate int_cart_classic/catwalk int_cart_classic/catwalk_left)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_classic/support_left int_cart_classic/support_left_left)
                (ai_migrate int_cart_classic/support_left int_cart_classic/support_left_center)
            )
            (ai_migrate int_cart_classic/support_right int_cart_classic/support_right_left)
            (ai_migrate int_cart_classic/stragglers int_cart_classic/stragglers_left)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
        (begin
            (ai_migrate int_cart_classic/anchors_core int_cart_classic/anchors_core_right)
            (ai_migrate int_cart_classic/fodder_core int_cart_classic/fodder_core_right)
            (ai_migrate int_cart_classic/catwalk int_cart_classic/catwalk_right)
            (ai_migrate int_cart_classic/support_left int_cart_classic/support_left_right)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_classic/support_right int_cart_classic/support_right_right)
                (ai_migrate int_cart_classic/support_right int_cart_classic/support_right_center)
            )
            (ai_migrate int_cart_classic/stragglers int_cart_classic/stragglers_right)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
        (if
            (and
                (!= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (!= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
            )
            (begin
                (ai_migrate int_cart_classic/anchors_core int_cart_classic/anchors_core_front)
                (ai_migrate int_cart_classic/fodder_core int_cart_classic/anchors_core_front)
                (ai_migrate int_cart_classic/stragglers int_cart_classic/stragglers_front)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
        (begin
            (ai_migrate int_cart_classic/anchors_core int_cart_classic/anchors_core_center)
            (ai_migrate int_cart_classic/fodder_core int_cart_classic/fodder_core_center)
            (ai_migrate int_cart_classic/support_left int_cart_classic/support_left_rear)
            (ai_migrate int_cart_classic/support_right int_cart_classic/support_right_rear)
            (ai_migrate int_cart_classic/stragglers int_cart_classic/stragglers_center)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
        (begin
            (ai_migrate int_cart_classic/support_left int_cart_classic/support_left_rear)
            (ai_migrate int_cart_classic/support_right int_cart_classic/support_right_rear)
            (ai_migrate int_cart_classic/stragglers int_cart_classic/stragglers_center)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits guards_tapped_bit) 1)
            (> 0.750000 (ai_living_fraction int_cart_classic))
        )
        (begin
            (print_debug "m_int_cart_classic_updater: guards tapped")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_tapped_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits guards_pushed_bit) 1)
            (or
                (> 0.500000 (ai_living_fraction int_cart_classic))
                (= 0 (ai_living_count int_cart_classic/anchors_core))
            )
        )
        (begin
            (print_debug "m_int_cart_classic_updater: guards pushed")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_tapped_bit 1))
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_pushed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits guards_destroyed_bit) 1)
            (> 0.250000 (ai_living_fraction int_cart_classic))
        )
        (begin
            (print_debug "m_int_cart_classic_updater: guards destroyed")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_tapped_bit 1))
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_pushed_bit 1))
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_destroyed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits player_approached_bit) 1)
            (or
                (= (bit_test m_int_cart_classic_statebits guards_pushed_bit) 1)
                (and
                    (= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
                    (not
                        (and
                            (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                            (!= (bit_test m_int_cart_classic_statebits guards_tapped_bit) 1)
                        )
                    )
                )
            )
        )
        (begin
            (print_debug "m_int_cart_classic_updater: player approached")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits player_approached_bit 1))
            (ai_command_list_advance int_cart_classic)
            (if
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (begin
                    (ai_magically_see_players int_cart_classic)
                    (print_debug "m_int_cart_classic_updater: player approached with frontal assault")
                )
            )
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits player_fled_bit) 1)
            (= (bit_test m_int_cart_classic_statebits player_approached_bit) 1)
            (!= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
        )
        (begin
            (print_debug "m_int_cart_classic_updater: player is a coward")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits player_fled_bit 1))
            (game_save_no_timeout)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits guards_broken_bit) 1)
            (or
                (= (bit_test m_int_cart_classic_statebits gen_bit) 1)
                (= (bit_test m_int_cart_classic_statebits guards_destroyed_bit) 1)
            )
        )
        (begin
            (print_debug "m_int_cart_classic_updater: units broken")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits guards_broken_bit 1))
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                )
                (ai_berserk int_cart_classic/support_right 1)
            )
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                )
                (ai_berserk int_cart_classic/support_left 1)
            )
            (ai_maneuver int_cart_classic)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits reins_other_triggered_bit) 1)
            (or
                (= (bit_test m_int_cart_classic_statebits gen_bit) 1)
                (and
                    (= (bit_test m_int_cart_classic_statebits guards_destroyed_bit) 1)
                    (> m_int_cart_classic_combat_ticks 120)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_classic_updater: calling other gens' reins")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits reins_other_triggered_bit 1))
            (m_int_cart_evolved_rein_left)
            (m_int_cart_brute_rein_right)
        )
    )
    (if
        (and
            (or
                (= (bit_test m_int_cart_classic_statebits guards_broken_bit) 1)
                (and
                    (= (bit_test m_int_cart_classic_statebits guards_pushed_bit) 1)
                    (> m_int_cart_classic_combat_ticks 180)
                )
            )
            (= 3 m_int_cart_gen_count)
        )
        (begin (print_debug "m_int_cart_classic_updater: ending") (m_int_cart_classic_end))
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits reins_l_placed_bit) 1)
            (!= (bit_test m_int_cart_classic_statebits gen_bit) 1)
            (= (bit_test m_int_cart_classic_statebits reins_l_place_bit) 1)
            (not (volume_test_players_any int_cart_classic_secret_l))
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_classic_updater: placing right reins")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits reins_l_placed_bit 1))
            (if
                (game_is_impossible)
                (begin
                    (ai_place int_cart_classic/elites_core_rein_imposs)
                    (ai_migrate int_cart_classic/elites_core_rein_imposs int_cart_classic/elites_core_rein)
                )
                (ai_place int_cart_classic/elites_core_rein)
            )
            (ai_place int_cart_classic/jackals_left_rein)
            (ai_magically_see_players int_cart_classic)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits reins_r_placed_bit) 1)
            (!= (bit_test m_int_cart_classic_statebits gen_bit) 1)
            (= (bit_test m_int_cart_classic_statebits reins_r_place_bit) 1)
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_classic_updater: placing right reins")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits reins_r_placed_bit 1))
            (ai_place int_cart_classic/jackals_right_rein)
            (ai_magically_see_players int_cart_classic)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_classic_statebits catwalk_placed_bit) 1)
            (> 2 (ai_living_count int_cart_hunters))
            (or
                (= (bit_test m_int_cart_classic_statebits guards_destroyed_bit) 1)
                (> m_int_cart_classic_combat_ticks 90)
                (and
                    (= (bit_test m_int_cart_classic_statebits reins_r_placed_bit) 1)
                    (= (bit_test m_int_cart_classic_statebits reins_l_placed_bit) 1)
                )
                (and
                    (= (bit_test m_int_cart_classic_statebits guards_pushed_bit) 1)
                    (= (bit_test m_int_cart_classic_statebits player_fled_bit) 1)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_classic_updater: placing catwalk reins")
            (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits catwalk_placed_bit 1))
            (ai_place int_cart_classic/grunts_catwalk_rein)
            (ai_magically_see_players int_cart_classic)
        )
    )
    (if
        (and
            (= (bit_test m_int_cart_classic_statebits player_approached_bit) 1)
            (= (bit_test m_int_cart_classic_statebits guards_tapped_bit) 1)
        )
        (set m_int_cart_classic_combat_ticks (+ m_int_cart_classic_combat_ticks cart_update_cycle_rate))
    )
    (sleep cart_update_cycle_rate)
)


(script dormant m_int_cart_classic_objs
    (sleep_until
        (= 1.000000 (device_group_get power_int_shaft_c_gen_classc))
    )
    (set m_int_cart_classic_statebits (bit_toggle m_int_cart_classic_statebits gen_bit 1))
    (set m_int_cart_gen_count (+ m_int_cart_gen_count 1.000000))
    (deactivate_team_nav_point_flag player int_cart_gen_classic_nav)
)


(script static void m_int_cart_classic_init
    (if
        (game_is_impossible)
        (begin
            (ai_place int_cart_classic/elites_core_imposs)
            (ai_migrate int_cart_classic/elites_core_imposs int_cart_classic/elites_core)
        )
        (ai_place int_cart_classic/elites_core)
    )
    (ai_place int_cart_classic/jackals_left)
    (ai_place int_cart_classic/jackals_right)
    (ai_place int_cart_classic/grunts_left)
    (ai_place int_cart_classic/grunts_right)
    (set m_int_cart_classic_start 1)
    (wake m_int_cart_classic_objs)
)


(script continuous m_int_cart_evolved_updater
    (sleep_until m_int_cart_evolved_start 1)
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_l (volume_test_players_all int_cart_evolved_left))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_r (volume_test_players_all int_cart_evolved_right))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_f (volume_test_players_all int_cart_evolved_front))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_c (volume_test_players_all int_cart_evolved_center))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_b (volume_test_players_all int_cart_evolved_back))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_u (volume_test_players_all int_cart_upper))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle
            m_int_cart_pos_statebits
            player_pos_any
            (or
                (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                (game_is_cooperative)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
        (begin
            (ai_migrate int_cart_evolved/anchors_core int_cart_evolved/anchors_core_left)
            (ai_migrate int_cart_evolved/fodder_core int_cart_evolved/fodder_core_left)
            (ai_migrate int_cart_evolved/catwalk int_cart_evolved/catwalk_left)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_evolved/support_left int_cart_evolved/support_left_left)
                (ai_migrate int_cart_evolved/support_left int_cart_evolved/support_left_center)
            )
            (ai_migrate int_cart_evolved/support_right int_cart_evolved/support_right_left)
            (ai_migrate int_cart_evolved/stragglers int_cart_evolved/stragglers_left)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
        (begin
            (ai_migrate int_cart_evolved/anchors_core int_cart_evolved/anchors_core_right)
            (ai_migrate int_cart_evolved/fodder_core int_cart_evolved/fodder_core_right)
            (ai_migrate int_cart_evolved/catwalk int_cart_evolved/catwalk_right)
            (ai_migrate int_cart_evolved/support_left int_cart_evolved/support_left_right)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_evolved/support_right int_cart_evolved/support_right_right)
                (ai_migrate int_cart_evolved/support_right int_cart_evolved/support_right_center)
            )
            (ai_migrate int_cart_evolved/stragglers int_cart_evolved/stragglers_right)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
        (if
            (and
                (!= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (!= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
            )
            (begin
                (ai_migrate int_cart_evolved/anchors_core int_cart_evolved/anchors_core_front)
                (ai_migrate int_cart_evolved/fodder_core int_cart_evolved/anchors_core_front)
                (ai_migrate int_cart_evolved/stragglers int_cart_evolved/stragglers_front)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
        (begin
            (ai_migrate int_cart_evolved/anchors_core int_cart_evolved/anchors_core_center)
            (ai_migrate int_cart_evolved/fodder_core int_cart_evolved/fodder_core_center)
            (ai_migrate int_cart_evolved/support_left int_cart_evolved/support_left_rear)
            (ai_migrate int_cart_evolved/support_right int_cart_evolved/support_right_rear)
            (ai_migrate int_cart_evolved/stragglers int_cart_evolved/stragglers_center)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
        (begin
            (ai_migrate int_cart_evolved/support_left int_cart_evolved/support_left_rear)
            (ai_migrate int_cart_evolved/support_right int_cart_evolved/support_right_rear)
            (ai_migrate int_cart_evolved/stragglers int_cart_evolved/stragglers_center)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits guards_tapped_bit) 1)
            (> 0.750000 (ai_living_fraction int_cart_evolved))
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: guards tapped")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_tapped_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits guards_pushed_bit) 1)
            (or
                (> 0.500000 (ai_living_fraction int_cart_evolved))
                (= 0 (ai_living_count int_cart_evolved/anchors_core))
            )
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: guards pushed")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_tapped_bit 1))
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_pushed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits guards_destroyed_bit) 1)
            (> 0.250000 (ai_living_fraction int_cart_evolved))
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: guards destroyed")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_tapped_bit 1))
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_pushed_bit 1))
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_destroyed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits player_approached_bit) 1)
            (or
                (= (bit_test m_int_cart_evolved_statebits guards_pushed_bit) 1)
                (and
                    (= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
                    (not
                        (and
                            (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                            (!= (bit_test m_int_cart_evolved_statebits guards_tapped_bit) 1)
                        )
                    )
                )
            )
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: player approached")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits player_approached_bit 1))
            (ai_command_list_advance int_cart_evolved)
            (if
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (begin
                    (ai_magically_see_players int_cart_evolved)
                    (print_debug "m_int_cart_evolved_updater: player approached with frontal assault")
                )
            )
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits player_fled_bit) 1)
            (= (bit_test m_int_cart_evolved_statebits player_approached_bit) 1)
            (!= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: player is a coward")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits player_fled_bit 1))
            (game_save_no_timeout)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits guards_broken_bit) 1)
            (or
                (= (bit_test m_int_cart_evolved_statebits gen_bit) 1)
                (= (bit_test m_int_cart_evolved_statebits guards_destroyed_bit) 1)
            )
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: units broken")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits guards_broken_bit 1))
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                )
                (ai_berserk int_cart_evolved/support_right 1)
            )
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                )
                (ai_berserk int_cart_evolved/support_left 1)
            )
            (ai_maneuver int_cart_evolved)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits reins_other_triggered_bit) 1)
            (or
                (= (bit_test m_int_cart_evolved_statebits gen_bit) 1)
                (and
                    (= (bit_test m_int_cart_evolved_statebits guards_destroyed_bit) 1)
                    (> m_int_cart_evolved_combat_ticks 120)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: calling other gens' reins")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits reins_other_triggered_bit 1))
            (m_int_cart_brute_rein_left)
            (m_int_cart_classic_rein_right)
        )
    )
    (if
        (and
            (or
                (= (bit_test m_int_cart_evolved_statebits guards_broken_bit) 1)
                (and
                    (= (bit_test m_int_cart_evolved_statebits guards_pushed_bit) 1)
                    (> m_int_cart_evolved_combat_ticks 180)
                )
            )
            (= 3 m_int_cart_gen_count)
        )
        (begin (print_debug "m_int_cart_evolved_updater: ending") (m_int_cart_evolved_end))
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits reins_l_placed_bit) 1)
            (!= (bit_test m_int_cart_evolved_statebits gen_bit) 1)
            (= (bit_test m_int_cart_evolved_statebits reins_l_place_bit) 1)
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: placing right reins")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits reins_l_placed_bit 1))
            (ai_place int_cart_evolved/elites_left_rein)
            (ai_place int_cart_evolved/jackals_left_rein)
            (ai_magically_see_players int_cart_evolved)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits reins_r_placed_bit) 1)
            (!= (bit_test m_int_cart_evolved_statebits gen_bit) 1)
            (= (bit_test m_int_cart_evolved_statebits reins_r_place_bit) 1)
            (not (volume_test_players_any int_cart_evolved_secret_r))
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: placing right reins")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits reins_r_placed_bit 1))
            (if
                (game_is_impossible)
                (begin
                    (ai_place int_cart_evolved/grunts_right_rein_imposs)
                    (ai_migrate int_cart_evolved/grunts_right_rein_imposs int_cart_evolved/grunts_right_rein)
                )
                (ai_place int_cart_evolved/grunts_right_rein)
            )
            (ai_magically_see_players int_cart_evolved)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_evolved_statebits catwalk_placed_bit) 1)
            (> 2 (ai_living_count int_cart_hunters))
            (or
                (= (bit_test m_int_cart_evolved_statebits guards_destroyed_bit) 1)
                (> m_int_cart_evolved_combat_ticks 90)
                (and
                    (= (bit_test m_int_cart_evolved_statebits reins_r_placed_bit) 1)
                    (= (bit_test m_int_cart_evolved_statebits reins_l_placed_bit) 1)
                )
                (and
                    (= (bit_test m_int_cart_evolved_statebits guards_pushed_bit) 1)
                    (= (bit_test m_int_cart_evolved_statebits player_fled_bit) 1)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_evolved_updater: placing catwalk reins")
            (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits catwalk_placed_bit 1))
            (ai_place int_cart_evolved/jackals_catwalk_rein)
            (ai_magically_see_players int_cart_evolved)
        )
    )
    (if
        (and
            (= (bit_test m_int_cart_evolved_statebits player_approached_bit) 1)
            (= (bit_test m_int_cart_evolved_statebits guards_tapped_bit) 1)
        )
        (set m_int_cart_evolved_combat_ticks (+ m_int_cart_evolved_combat_ticks cart_update_cycle_rate))
    )
    (sleep cart_update_cycle_rate)
)


(script dormant m_int_cart_evolved_objs
    (sleep_until
        (= 1.000000 (device_group_get power_int_shaft_c_gen_evolve))
        1
    )
    (set m_int_cart_evolved_statebits (bit_toggle m_int_cart_evolved_statebits gen_bit 1))
    (set m_int_cart_gen_count (+ m_int_cart_gen_count 1.000000))
    (deactivate_team_nav_point_flag player int_cart_gen_evolved_nav)
)


(script static void m_int_cart_evolved_init
    (ai_place int_cart_evolved/elites_core)
    (ai_place int_cart_evolved/jackals_left)
    (ai_place int_cart_evolved/jackals_right)
    (if
        (game_is_impossible)
        (begin
            (ai_place int_cart_evolved/grunts_core_imposs)
            (ai_migrate int_cart_evolved/grunts_core_imposs int_cart_evolved/grunts_core)
        )
        (ai_place int_cart_evolved/grunts_core)
    )
    (set m_int_cart_evolved_start 1)
    (wake m_int_cart_evolved_objs)
)


(script continuous m_int_cart_brute_updater
    (sleep_until m_int_cart_brute_start 1)
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_l (volume_test_players_all int_cart_brutes_left))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_r (volume_test_players_all int_cart_brutes_right))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_f (volume_test_players_all int_cart_brutes_front))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_c (volume_test_players_all int_cart_brutes_center))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_b (volume_test_players_all int_cart_brutes_back))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_u (volume_test_players_all int_cart_upper))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle
            m_int_cart_pos_statebits
            player_pos_any
            (or
                (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                (game_is_cooperative)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
        (begin
            (ai_migrate int_cart_brutes/anchors_core int_cart_brutes/anchors_core_left)
            (ai_migrate int_cart_brutes/fodder_core int_cart_brutes/fodder_core_left)
            (ai_migrate int_cart_brutes/catwalk int_cart_brutes/catwalk_left)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_brutes/support_left int_cart_brutes/support_left_left)
                (ai_migrate int_cart_brutes/support_left int_cart_brutes/support_left_center)
            )
            (ai_migrate int_cart_brutes/support_right int_cart_brutes/support_right_left)
            (ai_migrate int_cart_brutes/stragglers int_cart_brutes/stragglers_left)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
        (begin
            (ai_migrate int_cart_brutes/anchors_core int_cart_brutes/anchors_core_right)
            (ai_migrate int_cart_brutes/fodder_core int_cart_brutes/fodder_core_right)
            (ai_migrate int_cart_brutes/catwalk int_cart_brutes/catwalk_right)
            (ai_migrate int_cart_brutes/support_left int_cart_brutes/support_left_right)
            (if
                (!= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
                (ai_migrate int_cart_brutes/support_right int_cart_brutes/support_right_right)
                (ai_migrate int_cart_brutes/support_right int_cart_brutes/support_right_center)
            )
            (ai_migrate int_cart_brutes/stragglers int_cart_brutes/stragglers_right)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
        (if
            (and
                (!= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                (!= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
            )
            (begin
                (ai_migrate int_cart_brutes/anchors_core int_cart_brutes/anchors_core_front)
                (ai_migrate int_cart_brutes/fodder_core int_cart_brutes/anchors_core_front)
                (ai_migrate int_cart_brutes/stragglers int_cart_brutes/stragglers_front)
            )
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_c) 1)
        (begin
            (ai_migrate int_cart_brutes/anchors_core int_cart_brutes/anchors_core_center)
            (ai_migrate int_cart_brutes/fodder_core int_cart_brutes/fodder_core_center)
            (ai_migrate int_cart_brutes/support_left int_cart_brutes/support_left_rear)
            (ai_migrate int_cart_brutes/support_right int_cart_brutes/support_right_rear)
            (ai_migrate int_cart_brutes/stragglers int_cart_brutes/stragglers_front)
        )
    )
    (if
        (= (bit_test m_int_cart_pos_statebits player_pos_b) 1)
        (begin
            (ai_migrate int_cart_brutes/support_left int_cart_brutes/support_left_rear)
            (ai_migrate int_cart_brutes/support_right int_cart_brutes/support_right_rear)
            (ai_migrate int_cart_brutes/stragglers int_cart_brutes/stragglers_center)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits guards_tapped_bit) 1)
            (> 0.750000 (ai_living_fraction int_cart_brutes))
        )
        (begin
            (print_debug "m_int_cart_brute_updater: guards tapped")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_tapped_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits guards_pushed_bit) 1)
            (or
                (> 0.500000 (ai_living_fraction int_cart_brutes))
                (= 0 (ai_living_count int_cart_brutes/anchors_core))
            )
        )
        (begin
            (print_debug "m_int_cart_brute_updater: guards pushed")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_tapped_bit 1))
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_pushed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits guards_destroyed_bit) 1)
            (> 0.250000 (ai_living_fraction int_cart_brutes))
        )
        (begin
            (print_debug "m_int_cart_brute_updater: guards destroyed")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_tapped_bit 1))
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_pushed_bit 1))
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_destroyed_bit 1))
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits player_approached_bit) 1)
            (or
                (= (bit_test m_int_cart_brute_statebits guards_pushed_bit) 1)
                (and
                    (= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
                    (not
                        (and
                            (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
                            (!= (bit_test m_int_cart_brute_statebits guards_tapped_bit) 1)
                        )
                    )
                )
            )
        )
        (begin
            (print_debug "m_int_cart_brute_updater: player approached")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits player_approached_bit 1))
            (ai_command_list_advance int_cart_brutes)
            (if
                (= (bit_test m_int_cart_pos_statebits player_pos_f) 1)
                (begin
                    (print_debug "m_int_cart_brute_updater: player approached with frontal assault")
                    (ai_magically_see_players int_cart_brutes)
                )
            )
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits player_fled_bit) 1)
            (= (bit_test m_int_cart_brute_statebits player_approached_bit) 1)
            (!= (bit_test m_int_cart_pos_statebits player_pos_any) 1)
        )
        (begin
            (print_debug "m_int_cart_brute_updater: player is a coward")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits player_fled_bit 1))
            (game_save_no_timeout)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits guards_broken_bit) 1)
            (or
                (= (bit_test m_int_cart_brute_statebits gen_bit) 1)
                (= (bit_test m_int_cart_brute_statebits guards_destroyed_bit) 1)
            )
        )
        (begin
            (print_debug "m_int_cart_brute_updater: units broken")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits guards_broken_bit 1))
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
                )
                (ai_berserk int_cart_brutes/support_right 1)
            )
            (if
                (and
                    (random_chance_50)
                    (= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
                )
                (ai_berserk int_cart_brutes/support_left 1)
            )
            (ai_maneuver int_cart_brutes)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits reins_other_triggered_bit) 1)
            (or
                (= (bit_test m_int_cart_brute_statebits gen_bit) 1)
                (and
                    (= (bit_test m_int_cart_brute_statebits guards_destroyed_bit) 1)
                    (> m_int_cart_brutes_combat_ticks 120)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_brute_updater: calling other gens' reins")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits reins_other_triggered_bit 1))
            (m_int_cart_evolved_rein_right)
            (m_int_cart_classic_rein_left)
        )
    )
    (if
        (and
            (or
                (= (bit_test m_int_cart_brute_statebits guards_broken_bit) 1)
                (and
                    (= (bit_test m_int_cart_brute_statebits guards_pushed_bit) 1)
                    (> m_int_cart_brutes_combat_ticks 180)
                )
            )
            (= 3 m_int_cart_gen_count)
        )
        (begin (print_debug "m_int_cart_brute_updater: ending") (m_int_cart_brute_end))
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits reins_l_placed_bit) 1)
            (!= (bit_test m_int_cart_brute_statebits gen_bit) 1)
            (= (bit_test m_int_cart_brute_statebits reins_l_place_bit) 1)
            (not (volume_test_players_any int_cart_brute_secret_l))
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_brute_updater: placing right reins")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits reins_l_placed_bit 1))
            (ai_place int_cart_brutes/jackals_left_rein)
            (ai_place int_cart_brutes/grunts_left_rein)
            (ai_magically_see_players int_cart_brutes)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits reins_r_placed_bit) 1)
            (!= (bit_test m_int_cart_brute_statebits gen_bit) 1)
            (= (bit_test m_int_cart_brute_statebits reins_r_place_bit) 1)
            (not (volume_test_players_any int_cart_brute_secret_r))
            (> 2 (ai_living_count int_cart_hunters))
        )
        (begin
            (print_debug "m_int_cart_brute_updater: placing right reins")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits reins_r_placed_bit 1))
            (ai_place int_cart_brutes/jackals_right_rein)
            (ai_place int_cart_brutes/grunts_right_rein)
            (ai_magically_see_players int_cart_brutes)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_brute_statebits catwalk_placed_bit) 1)
            (> 2 (ai_living_count int_cart_hunters))
            (or
                (= (bit_test m_int_cart_brute_statebits guards_destroyed_bit) 1)
                (> m_int_cart_brutes_combat_ticks 90)
                (and
                    (= (bit_test m_int_cart_brute_statebits reins_r_placed_bit) 1)
                    (= (bit_test m_int_cart_brute_statebits reins_l_placed_bit) 1)
                )
                (and
                    (= (bit_test m_int_cart_brute_statebits guards_pushed_bit) 1)
                    (= (bit_test m_int_cart_brute_statebits player_fled_bit) 1)
                )
            )
        )
        (begin
            (print_debug "m_int_cart_brute_updater: placing catwalk reins")
            (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits catwalk_placed_bit 1))
            (ai_place int_cart_brutes/grunts_catwalk_rein)
            (ai_magically_see_players int_cart_brutes)
        )
    )
    (if
        (and
            (= (bit_test m_int_cart_brute_statebits player_approached_bit) 1)
            (= (bit_test m_int_cart_brute_statebits guards_tapped_bit) 1)
        )
        (set m_int_cart_brutes_combat_ticks (+ m_int_cart_brutes_combat_ticks cart_update_cycle_rate))
    )
    (sleep cart_update_cycle_rate)
)


(script dormant m_int_cart_brute_objs
    (sleep_until
        (= 1.000000 (device_group_get power_int_shaft_c_gen_brute))
        1
    )
    (set m_int_cart_brute_statebits (bit_toggle m_int_cart_brute_statebits gen_bit 1))
    (set m_int_cart_gen_count (+ m_int_cart_gen_count 1.000000))
    (deactivate_team_nav_point_flag player int_cart_gen_brute_nav)
)


(script static void m_int_cart_brute_init
    (ai_place int_cart_brutes/brutes_core)
    (ai_place int_cart_brutes/grunts_core)
    (ai_place int_cart_brutes/grunts_left)
    (ai_place int_cart_brutes/grunts_right)
    (if
        (= normal (game_difficulty_get_real))
        (ai_place int_cart_brutes/brutes_normal)
        (if
            (= hard (game_difficulty_get_real))
            (ai_place int_cart_brutes/brutes_hard)
            (if (game_is_impossible) (ai_place int_cart_brutes/brutes_imposs))
        )
    )
    (set m_int_cart_brute_start 1)
    (wake m_int_cart_brute_objs)
)


(script continuous m_int_cart_sides_updater
    (sleep_until m_int_cart_sides_start 1)
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_l (volume_test_players_any int_cart_nook_left))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_r (volume_test_players_any int_cart_nook_right))
    )
    (set
        m_int_cart_pos_statebits
        (bit_toggle m_int_cart_pos_statebits player_pos_u (volume_test_players_any int_cart_upper))
    )
    (if
        (!= (bit_test m_int_cart_pos_statebits player_pos_l) 1)
        (if
            (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
            (ai_migrate int_cart_sides/right int_cart_sides/right_upper)
            (ai_migrate int_cart_sides/right int_cart_sides/right_lower)
        )
    )
    (if
        (!= (bit_test m_int_cart_pos_statebits player_pos_r) 1)
        (if
            (= (bit_test m_int_cart_pos_statebits player_pos_u) 1)
            (ai_migrate int_cart_sides/left int_cart_sides/left_upper)
            (ai_migrate int_cart_sides/left int_cart_sides/left_lower)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_sides_statebits rein_l_placed_bit) 1)
            (or
                (and
                    (<= 1 m_int_cart_gen_count)
                    (= 0 (ai_living_count int_cart_sides/left))
                    (= 0 (ai_living_count int_cart_sides/fodder_left))
                    (> 2 (ai_living_count int_cart_hunters))
                )
                (and
                    (<= 2 m_int_cart_gen_count)
                    (= 0 (ai_living_count int_cart_sides/left))
                    (= 0 (ai_living_count int_cart_sides/fodder_left))
                )
            )
        )
        (begin
            (print_debug "m_int_cart_sides_updater: placing left sniper & friends")
            (set m_int_cart_sides_statebits (bit_toggle m_int_cart_sides_statebits rein_l_placed_bit 1))
            (ai_place int_cart_sides/sniper_left_rein)
            (ai_place int_cart_sides/grunts_left_rein)
            (ai_magically_see_players int_cart_sides)
        )
    )
    (if
        (and
            (!= (bit_test m_int_cart_sides_statebits rein_r_placed_bit) 1)
            (or
                (and
                    (<= 1 m_int_cart_gen_count)
                    (= 0 (ai_living_count int_cart_sides/right))
                    (= 0 (ai_living_count int_cart_sides/fodder_right))
                    (> 2 (ai_living_count int_cart_hunters))
                )
                (and
                    (<= 2 m_int_cart_gen_count)
                    (= 0 (ai_living_count int_cart_sides/right))
                    (= 0 (ai_living_count int_cart_sides/fodder_right))
                )
            )
        )
        (begin
            (print_debug "m_int_cart_sides_updater: placing right sniper & friends")
            (set m_int_cart_sides_statebits (bit_toggle m_int_cart_sides_statebits rein_r_placed_bit 1))
            (ai_place int_cart_sides/sniper_right_rein)
            (ai_place int_cart_sides/grunts_right_rein)
            (ai_magically_see_players int_cart_sides)
        )
    )
    (sleep cart_update_cycle_rate)
)


(script static void m_int_cart_sides_init
    (print_debug m_int_cart_sides_init)
    (ai_place int_cart_sides/grunts_left)
    (ai_place int_cart_sides/grunts_right)
    (ai_place int_cart_sides/jackals_left)
    (ai_place int_cart_sides/jackals_right)
    (ai_magically_see_players int_cart_sides)
    (set m_int_cart_sides_start 1)
)


(script static void m_int_cart_sides_end
    (print_debug m_int_cart_sides_end)
    (sleep -1 m_int_cart_sides_updater)
)


(script continuous m_int_cart_hunters_updater
    (sleep_until m_int_cart_hunters_start 1)
    (if
        (game_is_cooperative)
        (if
            (<
                (objects_distance_to_object (ai_actors int_cart_hunters/hunter_chase) (player0))
                (objects_distance_to_object (ai_actors int_cart_hunters/hunter_chase) (player1))
            )
            (set m_int_cart_hunter_target (player0))
            (set m_int_cart_hunter_target (player1))
        )
        (set m_int_cart_hunter_target (player0))
    )
    (if
        (volume_test_object int_cart_entrance m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_entrance)
    )
    (if
        (volume_test_object int_cart_evolved_left m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_evolved_l)
    )
    (if
        (volume_test_object int_cart_evolved_right m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_evolved_r)
    )
    (if
        (volume_test_object int_cart_brutes_left m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_brute_l)
    )
    (if
        (volume_test_object int_cart_brutes_right m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_brute_r)
    )
    (if
        (volume_test_object int_cart_classic_left m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_classic_l)
    )
    (if
        (volume_test_object int_cart_classic_right m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_classic_r)
    )
    (if
        (volume_test_object int_cart_nook_left m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_l_nook)
    )
    (if
        (volume_test_object int_cart_nook_right m_int_cart_hunter_target)
        (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters/hunter_chase_r_nook)
    )
    (if
        (or
            (volume_test_players_all int_cart_nook_right)
            (volume_test_players_all int_cart_brutes_left)
            (volume_test_players_all int_cart_classic_right)
        )
        (ai_migrate int_cart_hunters_side/right int_cart_hunters_side/right_present)
        (if
            (or
                (volume_test_players_all int_cart_brutes_front)
                (volume_test_players_all int_cart_classic_front)
            )
            (ai_migrate int_cart_hunters_side/right int_cart_hunters_side/right_near)
            (if
                (game_is_cooperative)
                (ai_migrate int_cart_hunters_side/right int_cart_hunters_side/right_all)
                (if 1 (ai_migrate int_cart_hunters_side/right int_cart_hunters_side/right_far))
            )
        )
    )
    (if
        (or
            (volume_test_players_all int_cart_nook_left)
            (volume_test_players_all int_cart_brutes_right)
            (volume_test_players_all int_cart_evolved_left)
        )
        (ai_migrate int_cart_hunters_side/left int_cart_hunters_side/left_present)
        (if
            (or
                (volume_test_players_all int_cart_brutes_front)
                (volume_test_players_all int_cart_evolved_front)
            )
            (ai_migrate int_cart_hunters_side/left int_cart_hunters_side/left_near)
            (if
                (game_is_cooperative)
                (ai_migrate int_cart_hunters_side/left int_cart_hunters_side/left_all)
                (if 1 (ai_migrate int_cart_hunters_side/left int_cart_hunters_side/left_far))
            )
        )
    )
    (sleep cart_update_cycle_rate)
)


(script static void m_int_cart_hunters_side
    (print_debug m_int_cart_hunters_side)
    (ai_migrate int_cart_hunters/hunter_guard int_cart_hunters_side/left_near)
    (ai_migrate int_cart_hunters/hunter_chase int_cart_hunters_side/right_near)
)


(script static void m_int_cart_hunters_init
    (print_debug m_int_cart_hunters_init)
    (object_destroy int_shaft_c_cart_door_lower_lk)
    (object_create int_shaft_c_cart_door_lower)
    (device_set_position int_shaft_c_cart_door_lower 1.000000)
    (object_create int_shaft_c_hunter_lift)
    (skip_second)
    (if
        (>= normal (game_difficulty_get_real))
        (ai_place int_cart_hunters/hunter_guard_init_normal)
        (ai_place int_cart_hunters/hunter_guard_init_hard)
    )
    (ai_place int_cart_hunters/hunter_chase_init)
    (ai_place int_cart_hunters/servants_init)
    (ai_magically_see_players int_cart_hunters)
    (sleep 3)
    (ai_erase int_cart_hunters/hack)
    (set m_int_cart_hunters_start 1)
)


(script static void m_int_cart_hunters_end
    (print_debug m_int_cart_hunters_end)
    (sleep -1 m_int_cart_hunters_updater)
    (ai_migrate int_cart_hunters int_cart_hunters_side)
    (ai_migrate int_cart_hunters_side int_cart_hunters_side/retreat)
    (ai_defend int_cart_hunters_side)
)


(script dormant m_int_cart_main
    (print_debug "m_int_cart_main: starting")
    (sleep_until (volume_test_players_any int_cart_door_outer))
    (print_debug "m_int_cart_main: player approaching")
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_14_cart_door)
    (sleep_until (volume_test_players_any int_hallways_lobby_exit))
    (print_debug "m_int_cart_main: player at midpoint")
    (m_int_cart_brute_init)
    (skip_frame)
    (m_int_cart_evolved_init)
    (skip_frame)
    (m_int_cart_classic_init)
    (skip_frame)
    (m_int_cart_sides_init)
    (skip_frame)
    (game_save_no_timeout)
    (ai_place int_cart_hunters/hack)
    (ai_place int_cart_sword_imposs)
    (sleep_until
        (or
            (volume_test_players_any int_cart_entrance)
            (< 0.500000 (device_get_position int_shaft_c_cart_door_upper))
        )
    )
    (print_debug "m_int_cart_main: player at cartographer")
    (garbage_collect_now)
    (game_save_no_timeout)
    (ai_magically_see_players int_cart_sword_imposs)
    (ai_magically_see_players int_cart_evolved)
    (ai_magically_see_players int_cart_classic)
    (ai_conversation int_cart_entered)
    (sleep_until (volume_test_players_any int_cart_entrance))
    (sleep 60)
    (ai_magically_see_players int_cart_evolved)
    (ai_magically_see_players int_cart_classic)
    (ai_migrate int_cart_sword_imposs int_cart_hunters/hunter_chase_entrance)
    (print_debug "m_int_cart_main: awaiting first generator")
    (print_debug "m_int_cart_main: deploying helpful hints")
    (ai_conversation int_cart_gen_hint)
    (sleep 72)
    (activate_team_nav_point_flag go_here player int_cart_gen_brute_nav 0.000000)
    (activate_team_nav_point_flag go_here player int_cart_gen_evolved_nav 0.000000)
    (activate_team_nav_point_flag go_here player int_cart_gen_classic_nav 0.000000)
    (objective_set dia_gen0 obj_gen0)
    (sleep 60)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15_cart_arena)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
    (set m_int_cart_checkpoint_start 1)
    (if (game_is_impossible) (m_int_cart_hunters_init))
    (sleep_until (= 1 m_int_cart_gen_count))
    (print_debug "m_int_cart_main: first generator active")
    (game_save_no_timeout)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_14_cart_door)
    (ai_conversation int_cart_gen_first)
    (objective_set dia_gen1 obj_gen1)
    (if
        (not (game_is_impossible))
        (m_int_cart_hunters_init)
    )
    (print_debug "m_int_cart_main: awaiting second generator")
    (sleep_until (= 2 m_int_cart_gen_count))
    (print_debug "m_int_cart_main: second generator active")
    (game_save_no_timeout)
    (ai_conversation int_cart_gen_second)
    (objective_set dia_gen2 obj_gen2)
    (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15_cart_arena)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15a_cart_arena_end)
    (m_int_cart_hunters_side)
    (print_debug "m_int_cart_main: awaiting final generator")
    (sleep_until (= 3 m_int_cart_gen_count))
    (print_debug "m_int_cart_main: final generator active")
    (game_save_no_timeout)
    (m_int_cart_brute_end)
    (m_int_cart_evolved_end)
    (m_int_cart_classic_end)
    (objective_set dia_gen3 obj_gen3)
    (ai_conversation int_cart_switchit)
    (sleep 114)
    (activate_team_nav_point_flag go_here player int_cart_cutscene_end_0 0.300000)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15_cart_arena)
    (print_debug "m_int_cart_main: awaiting player on upper floor")
    (sleep_until (volume_test_players_any int_cart_upper) 1)
    (m_int_cart_hunters_end)
    (m_int_cart_sides_end)
    (print_debug "m_int_cart_main: awaiting map room activation")
    (sleep_until
        (!= 0.000000 (device_get_position int_shaft_c_cart_switch))
        1
    )
    (deactivate_team_nav_point_flag player int_cart_cutscene_end_0)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15a_cart_arena_end)
    (m_int_cart_cutscene)
    (game_save_no_timeout)
    (set mission_state mission_cartographer_activated)
    (print_debug "m_int_cart_main: map room activated")
)


(script static real m_int_cart_get_cheif_strength
    (if
        (and
            (!= none master_cheif_0)
            (!= none master_cheif_1)
        )
        (min
            (unit_get_shield master_cheif_0)
            (unit_get_shield master_cheif_1)
        )
        (if
            (!= none master_cheif_0)
            (unit_get_shield master_cheif_0)
            (if
                (!= none master_cheif_1)
                (unit_get_shield master_cheif_1)
                (if 1 0.000000 0.000000)
            )
        )
    )
)


(script continuous m_int_cart_special_fuckery
    (sleep_until m_int_cart_fuckery_start 1)
    (if
        (random_chance_50)
        (begin_random
            (hud_show_shield 1)
            (hud_show_health 1)
            (hud_show_motion_sensor 1)
            (hud_show_shield 0)
            (hud_show_health 0)
            (hud_show_motion_sensor 0)
            (sleep 105)
        )
        (sleep (* 150.000000 (m_int_cart_get_cheif_strength)))
    )
    (sleep 30)
)


(script continuous m_int_cart_special_updater
    (sleep_until m_int_cart_special_start 1)
    (ai_magically_see_players int_cart_cyborg)
    (if
        special_drop_grunts
        (set special_grunt_drop_timer (- special_grunt_drop_timer 1.000000))
    )
    (if
        (> (ai_living_count int_cart_cyborg) 0)
        (begin
            (set
                special_intensity_scale
                (max
                    special_intensity_scale
                    (- 1.010000 (m_int_cart_get_cheif_strength))
                )
            )
            (sound_looping_set_scale cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15b_cart_arena_easymode special_intensity_scale)
            (device_set_power secret_cart_light (- special_intensity_scale 0.500000))
            (cinematic_screen_effect_set_convolution
                1
                2
                0.000000
                (* special_intensity_scale 7.000000)
                0.000000
            )
            (if
                (volume_test_object int_cart_cyborg_rescue master_cheif_0)
                (object_teleport master_cheif_0 int_cart_cyborg_rescue_flag)
            )
            (if
                (volume_test_object int_cart_cyborg_rescue master_cheif_1)
                (object_teleport master_cheif_1 int_cart_cyborg_rescue_flag)
            )
        )
    )
    (if
        (< special_grunt_drop_timer 1)
        (begin
            (ai_place int_cart_special_grunts)
            (set
                special_grunt_drop_timer
                (+ (random_range 0 60) 45.000000)
            )
        )
    )
)


(script dormant m_int_cart_special_captain
    (sleep (random_range 170 210))
    (if
        (< 0.000000 (unit_get_health captain_nightmare))
        (sound_impulse_start sound\dialog\x20\keyes01 captain_nightmare 1.000000)
    )
)


(script dormant m_int_cart_special
    (sleep_until (volume_test_players_any int_cart_door_outer))
    (print_debug "m_int_cart_special: player approaching")
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_14_cart_door)
    (sleep_until (volume_test_players_any int_hallways_lobby_exit))
    (print_debug "m_int_cart_special: player at midpoint")
    (player_enable_input 0)
    (sleep 75)
    (show_hud 0)
    (skip_second)
    (fade_out 1.000000 0.000000 0.000000 0)
    (sound_impulse_start cmt\sounds\sfx\scenarios\b30_revamp\ambience\sounds\detail_howls_low none 1.000000)
    (sleep 60)
    (volume_teleport_players_not_inside int_hallways_lobby_exit int_cart_entrance_teleport)
    (player_enable_input 1)
    (device_set_position_immediate int_shaft_b_lobby_door 0.000000)
    (cinematic_screen_effect_start 1)
    (cinematic_screen_effect_set_convolution 1 2 15.000000 0.000000 3.000000)
    (fade_in 1.000000 0.000000 0.000000 90)
    (sleep 90)
    (cinematic_screen_effect_stop)
    (show_hud 1)
    (game_save_no_timeout)
    (sleep_until (volume_test_players_any int_cart_entrance))
    (ai_conversation int_cart_entered)
    (object_create_containing secret_cart)
    (set m_int_cart_special_start 1)
    (wake m_int_cart_classic_objs)
    (wake m_int_cart_evolved_objs)
    (wake m_int_cart_brute_objs)
    (print_debug "m_int_cart_special: awaiting first generator")
    (skip_second)
    (print_debug "m_int_cart_special: deploying helpful? hints")
    (ai_conversation int_cart_gen_hint_special)
    (objective_set dia_gen0_ez obj_gen0_ez)
    (sleep_until (= 1 m_int_cart_gen_count))
    (print_debug "m_int_cart_special: first generator active")
    (ai_conversation int_cart_gen_first_special)
    (objective_set dia_gen1_ez obj_gen1_ez)
    (print_debug "m_int_cart_special: awaiting second generator")
    (sleep_until (= 2 m_int_cart_gen_count))
    (print_debug "m_int_cart_special: second generator active")
    (ai_conversation int_cart_gen_second_special)
    (objective_set dia_gen2_ez obj_gen2_ez)
    (print_debug "m_int_cart_special: awaiting final generator")
    (sleep_until (= 3 m_int_cart_gen_count))
    (print_debug "m_int_cart_special: final generator active")
    (device_set_position grimdome 1.000000)
    (game_save_totally_unsafe)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_14_cart_door)
    (sound_looping_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15b_cart_arena_easymode none 0.000000)
    (ai_place int_cart_cyborg/master_cheif)
    (set
        master_cheif_0
        (unit
            (list_get (ai_actors int_cart_cyborg/master_cheif) 0)
        )
    )
    (cinematic_screen_effect_start 1)
    (ai_allegiance_remove human sentinel)
    (ai_magically_see_players int_cart_cyborg/master_cheif)
    (unit_doesnt_drop_items master_cheif_0)
    (sleep_until (< (m_int_cart_get_cheif_strength) 0.800000))
    (if
        (game_is_cooperative)
        (begin
            (ai_place int_cart_cyborg/master_cheif_echo)
            (set
                master_cheif_1
                (unit
                    (list_get (ai_actors int_cart_cyborg/master_cheif_echo) 0)
                )
            )
            (unit_doesnt_drop_items master_cheif_1)
        )
    )
    (sleep_until (< (m_int_cart_get_cheif_strength) 0.600000))
    (set m_int_cart_fuckery_start 1)
    (sleep_until (< (m_int_cart_get_cheif_strength) 0.400000))
    (set special_drop_grunts 1)
    (sleep_until (< (m_int_cart_get_cheif_strength) 0.200000))
    (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15b_cart_arena_easymode)
    (sleep_until
        (= (ai_living_count int_cart_cyborg) 0)
        1
    )
    (sleep 20)
    (fade_out 0.000000 0.000000 0.000000 0)
    (game_save_cancel)
    (set special_drop_grunts 0)
    (ai_erase int_cart_special_grunts)
    (garbage_collect_now)
    (sleep 35)
    (teleport_players int_cart_nightmare_0 int_cart_nightmare_1)
    (object_create nightmare_zone)
    (object_create captain_nightmare)
    (sleep 35)
    (fade_in 0.000000 0.000000 0.000000 0)
    (wake m_int_cart_special_captain)
    (sleep_until
        (>= 0.000000 (unit_get_health captain_nightmare))
        1
    )
    (object_create the_silent_battle_rifle)
    (sleep_until
        (or
            (unit_has_weapon (player0) cmt\weapons\evolved\_egg\battle_rifle_silent\battle_rifle_silent)
            (unit_has_weapon (player1) cmt\weapons\evolved\_egg\battle_rifle_silent\battle_rifle_silent)
        )
    )
    (teleport_players int_cart_acquired_0 int_cart_acquired_1)
    (object_destroy nightmare_zone)
    (object_destroy captain_nightmare)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_15b_cart_arena_easymode)
    (object_destroy_containing secret_cart)
    (sleep -1 m_int_cart_special_fuckery)
    (hud_show_shield 1)
    (hud_show_health 1)
    (hud_show_motion_sensor 1)
    (cinematic_screen_effect_stop)
    (sleep -1 m_int_cart_special_updater)
    (sleep 120)
    (ai_conversation int_exit_special_leave)
    (sleep 60)
    (game_save_no_timeout)
    (set mission_state mission_cartographer_activated)
    (print_debug "m_int_cart_special: picked up the silent battle rifle")
)


(script static void m_int_cart_startup
    (if
        (game_is_easy)
        (wake m_int_cart_special)
        (wake m_int_cart_main)
    )
)


(script static void m_int_cart_cleanup
    (sleep -1 m_int_cart_special)
    (sleep -1 m_int_cart_main)
    (sleep -1 m_int_cart_checkpoint_bastard)
)


(script continuous m_int_hallways_update
    (sleep_until int_hallways_update_start 1)
    (if
        (and
            (> (ai_status int_hallways_lroom) 3)
            (not int_hallways_lroom_alerted)
        )
        (begin
            (set int_hallways_lroom_alerted 1)
            (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
            (print_debug "m_int_hallways_update: lroom ai were alerted; emergency defense")
            (ai_command_list_advance int_hallways_lroom/brutes_entrance)
            (ai_magically_see_players int_hallways_waterhall)
            (ai_magically_see_players int_hallways_lroom)
        )
    )
    (if
        (and
            (= (ai_status int_hallways_waterhall) 6)
            (not int_hallways_lroom_alerted)
        )
        (begin
            (set int_hallways_lroom_alerted 1)
            (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
            (print_debug "m_int_hallways_update: waterhall ai were alerted; lroom units preparing")
            (if
                (>= (game_difficulty_get_real) hard)
                (begin
                    (print_debug "m_int_hallways_update: heroic+ - lroom brutes preparing to flank")
                    (ai_command_list int_hallways_lroom/brutes_entrance int_hallways_lroom_ambush_tele)
                    (ai_command_list_advance int_hallways_lroom/brutes_entrance)
                    (ai_migrate int_hallways_lroom/brutes_entrance int_hallways_lroom/brutes_ambush)
                )
            )
            (ai_magically_see_players int_hallways_waterhall)
            (ai_magically_see_players int_hallways_lroom)
        )
    )
    (if
        (and (volume_test_players_all int_hallways_lobby_entrance_up) int_hallways_lroom_alerted)
        (begin
            (print_debug "m_int_hallways_update: player took alternate lroom exit")
            (ai_set_current_state int_hallways_lroom search)
            (ai_migrate int_hallways_lroom/brutes int_hallways_lobby/lroom_retreat)
            (ai_migrate int_hallways_lroom/jackals int_hallways_lobby/lroom_retreat)
            (ai_migrate int_hallways_lroom/grunts int_hallways_lroom/grunts_center)
            (ai_magically_see_players int_hallways_lroom)
            (ai_magically_see_players int_hallways_lobby)
            (ai_defend int_hallways_lobby)
            (sleep_forever)
        )
    )
    (sleep 15)
)


(script dormant m_int_hallways_foehammer
    (sleep_until
        (or
            int_hallways_lroom_alerted
            (volume_test_players_any int_hallways_waterhall_mid)
            (and
                (> (ai_status int_hallways_waterhall) 3)
                (not (volume_test_players_any int_hallways_waterhall_entrance))
            )
        )
    )
    (sleep (random_range 360 900))
    (if
        (not (game_is_easy))
        (ai_conversation shafta_descent)
    )
    (ai_kill lz_marines)
    (ai_kill lz_marines_holding)
)


(script dormant m_int_hallways
    (print_debug "m_int_hallways: initialized")
    (ai_place int_hallways_waterhall)
    (ai_set_blind int_hallways_waterhall 1)
    (ai_set_deaf int_hallways_waterhall 1)
    (sleep_until (volume_test_players_any int_hallways_waterhall_entrance))
    (print_debug "m_int_hallways: player nearing bottom of elevator; spooky music on")
    (garbage_collect_now)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
    (print_debug "m_int_hallways: waking m_int_hallways_update")
    (set int_hallways_update_start 1)
    (wake m_int_hallways_foehammer)
    (ai_set_blind int_hallways_waterhall 0)
    (ai_set_deaf int_hallways_waterhall 0)
    (game_save_no_timeout)
    (sleep_until
        (or
            (not (volume_test_players_any int_hallways_waterhall_entrance))
            (> (ai_status int_hallways_waterhall) 3)
        )
        1
    )
    (print_debug "m_int_hallways: ai alerted or player stopped camping")
    (if
        (volume_test_players_all int_hallways_waterhall_entrance)
        (begin
            (print_debug "m_int_hallways: player has alerted ai at entrance; elite(s) flanking")
            (ai_migrate int_hallways_waterhall/elite_upper int_hallways_waterhall/entrance_flank)
            (ai_magically_see_players int_hallways_waterhall)
            (sleep_until (not (volume_test_players_any int_hallways_waterhall_entrance)))
        )
    )
    (print_debug "m_int_hallways: player has moved past entrance; elite(s) moving back if were flanking")
    (ai_migrate int_hallways_waterhall/entrance_flank int_hallways_waterhall/elite_upper)
    (sleep_until (volume_test_players_any int_hallways_waterhall_upper) 1)
    (print_debug "m_int_hallways: player has moved to upper walkway; upper units retreating")
    (game_save_no_timeout)
    (ai_migrate int_hallways_waterhall/elite_upper int_hallways_waterhall/elite_mid)
    (ai_migrate int_hallways_waterhall/grunts_upper int_hallways_waterhall/elite_upper)
    (sleep_until (volume_test_players_any int_hallways_waterhall_mid) 1)
    (print_debug "m_int_hallways: player has moved to mid walkway")
    (game_save_no_timeout)
    (if
        (> (ai_living_count int_hallways_waterhall/elite_mid) 1)
        (begin
            (ai_attack int_hallways_waterhall/elite_mid)
            (print_debug "...elites will hold position")
        )
        (begin
            (ai_migrate int_hallways_waterhall/elite_mid int_hallways_waterhall/elite_lower)
            (print_debug "...elite retreating")
        )
    )
    (ai_migrate int_hallways_waterhall/upper int_hallways_waterhall/jackals_mid)
    (if (game_is_easy) (ai_erase int_hallways_waterhall))
    (sleep_until (volume_test_players_any int_hallways_waterhall_lower) 1)
    (print_debug "m_int_hallways: player has moved to exit; lower units defending, remaining units moving in")
    (ai_migrate int_hallways_waterhall/lower int_hallways_waterhall/elite_lower)
    (ai_migrate int_hallways_waterhall/upper int_hallways_waterhall/grunts_lower)
    (ai_migrate int_hallways_waterhall/mid int_hallways_waterhall/grunts_lower)
    (if
        (game_is_easy)
        (begin
            (phantom_of_the_map)
            (ai_place int_hallways_lroom/brootz_easy)
            (ai_migrate int_hallways_lroom/brootz_easy int_hallways_lroom/brutes_entrance)
        )
        (begin
            (ai_place int_hallways_lroom/grunts)
            (ai_place int_hallways_lroom/jackals)
            (ai_place int_hallways_lroom/brutes_entrance)
            (ai_place int_hallways_lroom/antechamber)
            (ai_place int_hallways_lroom/brute_imposs)
            (if
                (game_is_impossible)
                (ai_migrate int_hallways_lroom/brute_imposs int_hallways_lroom/snipers_entrance)
                (ai_place int_hallways_lroom/snipers)
            )
            (if
                (= (game_difficulty_get_real) normal)
                (begin
                    (print_debug "...brute leader will have a spiker")
                    (ai_place int_hallways_lroom/brutes_center)
                )
                (begin
                    (print_debug "...brute leader will have a bruteshot")
                    (ai_place int_hallways_lroom/brute_shot_brute)
                    (ai_migrate int_hallways_lroom/brute_shot_brute int_hallways_lroom/brutes_center)
                )
            )
        )
    )
    (sleep_until
        (or
            (< (ai_living_count int_hallways_waterhall) 1)
            (volume_test_players_any int_hallways_special_brootz)
        )
        1
    )
    (game_save_no_timeout)
    (if
        (game_is_easy)
        (begin
            (sleep_until (volume_test_players_any int_hallways_special_brootz) 1)
            (ai_place int_hallways_surprise_brootz)
            (teleport_players brootz_position_0 brootz_position_1)
        )
    )
    (sleep_until (volume_test_players_any int_hallways_lroom_entrance))
    (if
        int_hallways_lroom_alerted
        (begin
            (print_debug "m_int_hallways: player entered lroom - trap!!")
            (ai_migrate int_hallways_lroom/brutes_ambush int_hallways_lroom/brutes_entrance)
            (ai_migrate int_hallways_lroom/brutes_center int_hallways_lroom/brutes_entrance)
            (ai_migrate int_hallways_lroom/grunts int_hallways_lroom/grunts_entrance)
            (ai_migrate int_hallways_lroom/jackals_center int_hallways_lroom/jackals_entrance)
            (ai_magically_see_players int_hallways_lroom)
        )
        (print_debug "m_int_hallways: player entered lroom - ai still unaware of player")
    )
    (sleep_until (volume_test_players_any int_hallways_lroom_center))
    (print_debug "m_int_hallways: player approaching lroom center")
    (game_save_no_timeout)
    (ai_migrate int_hallways_lroom/brutes_entrance int_hallways_lroom/brutes_center)
    (ai_migrate int_hallways_lroom/jackals_entrance int_hallways_lroom/jackals_center)
    (ai_migrate int_hallways_lroom/grunts_entrance int_hallways_lroom/grunts_center)
    (ai_migrate int_hallways_lroom/snipers_entrance int_hallways_lroom/snipers_center)
    (if
        (and
            (game_is_impossible)
            (> (ai_living_count int_hallways_lroom/snipers_center) 0)
            int_hallways_lroom_alerted
        )
        (begin
            (sound_impulse_start
                cmt\sounds\dialog\characters\covenant\brute\h2_bloodthirsty_gibberish\involuntary\scream
                (list_get (ai_actors int_hallways_lroom/snipers_center) 0)
                1.000000
            )
            (ai_command_list int_hallways_lroom/snipers_center int_hallways_lroom_brute_jump)
            (ai_migrate int_hallways_lroom/snipers_center int_hallways_lroom/brutes_center)
        )
    )
    (sleep_until (volume_test_players_any int_hallways_lroom_exit) 1)
    (print_debug "m_int_hallways: player approaching lroom exit")
    (game_save_no_timeout)
    (ai_migrate int_hallways_lroom/brutes int_hallways_lobby/lroom_retreat)
    (ai_migrate int_hallways_lroom/jackals int_hallways_lroom/jackals_exit)
    (ai_migrate int_hallways_lroom/grunts int_hallways_lroom/grunts_exit)
    (sleep_until (volume_test_players_any int_hallways_lobby_entrance_low) 1)
    (game_save_no_timeout)
    (ai_migrate int_hallways_lroom/grunts int_hallways_lobby/lroom_retreat)
    (ai_migrate int_hallways_lroom/brutes int_hallways_lobby/lroom_retreat)
    (ai_migrate int_hallways_lroom/jackals int_hallways_lobby/lroom_retreat)
    (print_debug "m_int_hallways: player entering lobby")
    (print_debug_if
        (> (ai_living_count int_hallways_lroom) 1)
        "...remaining lroom units retreating"
    )
    (ai_magically_see_players int_hallways_lobby)
    (sleep_until
        (or
            (volume_test_players_any int_hallways_lobby_exit)
            (and
                (< (ai_living_count int_hallways_lroom) 1)
                (< (ai_living_count int_hallways_lobby) 1)
            )
        )
        1
    )
    (game_save_no_timeout)
    (sleep -1 m_int_hallways_update)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
    (print_debug "m_int_hallways: completed")
)


(script static void m_int_hallways_startup (wake m_int_hallways))


(script static void m_int_hallways_cleanup
    (sleep -1 m_int_hallways)
    (sleep -1 m_int_hallways_update)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_13_int)
)


(script dormant m_int_cutscene_ledge
    (sleep_until
        (or
            (volume_test_players_any int_shaft_edge)
            (volume_test_players_any int_shaft_ledge_big)
        )
        1
    )
    (if
        (not (volume_test_players_any int_shaft_edge))
        (sleep_forever)
    )
    (ai 0)
    (fade_to_white)
    (skip_second)
    (cinematic_start)
    (camera_control 1)
    (teleport_players player_ledge_wait player_ledge_wait)
    (skip_frame)
    (object_create_anew rock_kick)
    (camera_set shafta_ledge_1a 0)
    (x_cut_setup_player0 ledge_cyborg_0)
    (unit_set_seat ledge_cyborg_0 alert)
    (object_teleport ledge_cyborg_0 ledge_walk)
    (recording_play ledge_cyborg_0 ledge_cyborg_walk_0)
    (if
        (game_is_cooperative)
        (begin
            (x_cut_setup_player1 ledge_cyborg_1)
            (unit_set_seat ledge_cyborg_1 alert)
            (if
                (game_is_easy)
                (object_teleport ledge_cyborg_1 ledge_easy_await)
            )
        )
    )
    (skip_half_second)
    (fade_from_white)
    (camera_set shafta_ledge_1b 250)
    (sleep 200)
    (if
        (game_is_cooperative)
        (if
            (game_is_easy)
            (begin
                (object_teleport ledge_cyborg_1 ledge_easy_leave)
                (recording_play ledge_cyborg_1 ledge_cyborg_walk_0)
            )
            (recording_play ledge_cyborg_1 ledge_cyborg_walk_1)
        )
    )
    (sleep 50)
    (camera_set shafta_ledge_2a 0)
    (camera_set shafta_ledge_2b 240)
    (cinematic_set_title shafted)
    (sound_looping_predict sound\sinomatixx\b30_ledge_foley)
    (sleep 200)
    (object_teleport ledge_cyborg_0 ledge_look_0)
    (custom_animation ledge_cyborg_0 cinematics\animations\chief\level_specific\b30\b30 b30ledge 0)
    (scenery_animation_start rock_kick scenery\cutscene_small_rock\cutscene_small_rock clip01-rockfalling)
    (sound_looping_start sound\sinomatixx\b30_ledge_foley none 1.000000)
    (if
        (and
            (game_is_cooperative)
            (not (game_is_easy))
        )
        (object_teleport ledge_cyborg_1 ledge_look_1)
    )
    (camera_set shafta_ledge_3a 0)
    (camera_set shafta_ledge_3b 650)
    (sleep 30)
    (if
        (and
            (game_is_cooperative)
            (not (game_is_easy))
        )
        (custom_animation ledge_cyborg_1 cmt\characters\_shared\cyborg\cinematics\animations\level_specific\b30_revamp\b30_revamp look_with_intent 1)
    )
    (sleep 15)
    (player_effect_set_max_translation 0.000000 0.000000 0.000000)
    (player_effect_set_max_rotation 0.000000 0.000000 0.000000)
    (player_effect_set_max_vibrate 0.100000 0.100000)
    (player_effect_start 0.500000 0.100000)
    (player_effect_stop 0.400000)
    (sleep 145)
    (if
        (and
            (game_is_cooperative)
            (not (game_is_easy))
        )
        (recording_play ledge_cyborg_1 ledge_cyborg_turn_left)
    )
    (sleep 60)
    (fade_to_white)
    (skip_half_second)
    (teleport_players player_ledge_end_0 player_ledge_end_1)
    (x_cut_teardown_player0 ledge_cyborg_0)
    (if (game_is_cooperative) (x_cut_teardown_player1 ledge_cyborg_1))
    (object_destroy rock_kick)
    (show_hud 1)
    (camera_control 0)
    (cinematic_stop)
    (ai 1)
    (fade_from_white)
    (skip_half_second)
    (game_save_no_timeout)
)


(script static void m_int_launch
    (checkpoint_launch bsp_index_int_shaft_a m_int_spawn_0 m_int_spawn_1)
    (if
        (game_is_easy)
        (objective_set dia_found_ez obj_found_ez)
        (objective_set dia_found obj_found)
    )
)


(script static void m_int_start
    (print_debug "m_int_start: starting")
    (if
        (= b30r_launch_int mission_launch_index)
        (m_int_launch)
    )
    (object_create rock_kick)
    (sleep_until
        (and
            (= bsp_index_int_shaft_a (structure_bsp_index))
            (or
                (volume_test_players_any int_shaft_entered)
                (volume_test_players_any int_shaft_bridge)
                (volume_test_players_any int_shaft_ledge_big)
                (volume_test_players_any int_shaft_leaving)
            )
        )
        1
    )
    (set mission_state mission_cartographer_entered)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_03_cart_found)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_04_lockout)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_08_crash)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_09_crashsite)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_10_return_sneaky)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_11_return_hogrun)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_12_shafted)
    (wake m_int_cutscene_ledge)
    (sleep_until (volume_test_players_any int_elevator_descending) 1)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_12_shafted)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_12a_elevator)
    (garbage_collect_now)
    (game_save_no_timeout)
    (m_int_hallways_startup)
    (m_int_cart_startup)
)


(script static void m_int_clean
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_12_shafted)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_12a_elevator)
    (m_int_hallways_cleanup)
    (m_int_cart_cleanup)
)


(script static void m_int_skip
    (set mission_state mission_cartographer_entered)
    (set mission_state mission_cartographer_activated)
    (object_destroy rock_kick)
    (device_group_set_immediate position_int_shaft_a_bridge 1.000000)
    (device_group_set_immediate position_int_shaft_a_elevator 1.000000)
    (ai_kill lz_marines)
    (ai_kill lz_marines_holding)
    (device_set_position int_shaft_c_cart_door_upper 1.000000)
    (device_set_position_immediate int_shaft_c_cart_door_upper 1.000000)
    (device_group_set power_int_shaft_c_gen_classc 1.000000)
    (device_group_set power_int_shaft_c_gen_brute 1.000000)
    (device_group_set power_int_shaft_c_gen_evolve 1.000000)
    (device_group_set_immediate power_cartographer 1.000000)
    (device_group_set_immediate hack_int_shaft_c_holo_ring 1.000000)
    (device_set_position int_shaft_c_cart_switch 1.000000)
    (device_set_position_immediate int_shaft_c_holo_ring 1.000000)
    (device_set_position_immediate int_shaft_c_holo_glows 1.000000)
    (object_create int_shaft_c_hunter_lift)
    (if
        (game_is_easy)
        (device_set_position grimdome 1.000000)
    )
)


(script dormant m_int_control
    (if
        (!= m_int_ctrl_state 1)
        (m_int_skip)
        (m_int_start)
    )
    (sleep_until (>= m_int_ctrl_state 3))
    (m_int_clean)
)


(script static void m_int_startup
    (if
        (= 0 m_int_ctrl_state)
        (begin
            (set m_int_ctrl_state 1)
            (wake m_int_control)
        )
    )
)


(script static void m_int_cleanup
    (set m_int_ctrl_state 3)
)


(script static void m_int_mark_skip
    (m_int_startup)
    (set m_int_ctrl_state 2)
)


(script dormant m_exit_cutscene_extraction
    (cinematic_show_letterbox 1)
    (show_hud 0)
    (vehicle_hover insertion_pelican_1 0)
    (recording_play_and_hover insertion_pelican_1 extraction_pelican_out)
    (sleep 50)
    (ai_conversation extraction)
    (sleep 50)
    (fade_to_white)
    (skip_second)
    (camera_control 1)
    (cinematic_start)
    (camera_set cutscene_extraction_1a 0)
    (unit_close insertion_pelican_1)
    (sound_looping_start cmt\sounds\sfx\scenarios\b30_revamp\foley\b30r_extraction_foley none 1.000000)
    (fade_from_white)
    (skip_second)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_20_extraction)
    (player_effect_rumble)
    (sleep 35)
    (player_effect_stop 3.000000)
    (camera_set cutscene_extraction_1b 130)
    (sleep 139)
    (switch_bsp bsp_index_ext_sapp)
    (recording_kill insertion_pelican_1)
    (object_teleport insertion_pelican_1 extraction_pelican_hack_flag)
    (recording_play insertion_pelican_1 extraction_pelican_hack)
    (camera_set cutscene_extraction_2a 0)
    (camera_set cutscene_extraction_2b 300)
    (skip_frame)
    (ai_kill ext_lid)
    (ai_kill return_lid)
    (sleep 148)
    (player_effect_set_max_rotation 0.000000 0.400000 0.400000)
    (player_effect_set_max_rumble 0.400000 0.400000)
    (player_effect_start 1.000000 2.000000)
    (sleep 100)
    (object_create_anew_containing lid_dust)
    (object_create_anew_containing lid_crate)
    (device_set_position extraction_lid 1.000000)
    (sleep 20)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_19_surface)
    (sleep 40)
    (device_set_position_immediate extraction_lid 0.800000)
    (switch_bsp bsp_index_int_shaft_b)
    (camera_set cutscene_extraction_3a 0)
    (camera_set cutscene_extraction_3b 585)
    (device_set_position extraction_lid 0.000000)
    (player_effect_stop 13.000000)
    (ai_erase int_hallways_lroom)
    (ai_erase exit_lroom)
    (fade_in 1.000000 1.000000 1.000000 45)
    (object_create_anew extraction_lid_flare)
    (object_teleport insertion_pelican_1 extraction_pelican_shaft_flag)
    (recording_kill insertion_pelican_1)
    (vehicle_hover insertion_pelican_1 0)
    (recording_play insertion_pelican_1 extraction_pelican_descend)
    (sleep 175)
    (object_destroy lid_crate_1)
    (object_create bounce_crate)
    (object_teleport insertion_pelican_1 extraction_pelican_shaft_flag_2)
    (camera_set cutscene_extraction_4a 0)
    (camera_set cutscene_extraction_4b 600)
    (sleep 155)
    (fade_to_white)
    (sleep 150)
    (snap_to_black)
    (set mission_state mission_extracted)
    (sleep 120)
    (cinematic_stop)
    (show_hud 0)
    (player_enable_input 0)
)


(script dormant m_exit_secret_cutscene
    (if
        (unit_has_weapon (player0) cmt\weapons\evolved\_egg\battle_rifle_silent\battle_rifle_silent)
        (set m_exit_secret_cutscene_unit (player0))
    )
    (if
        (unit_has_weapon (player1) cmt\weapons\evolved\_egg\battle_rifle_silent\battle_rifle_silent)
        (set m_exit_secret_cutscene_unit (player1))
    )
    (if
        (= none m_exit_secret_cutscene_unit)
        (sleep -1)
    )
    (sleep_until
        (not (unit_has_weapon m_exit_secret_cutscene_unit cmt\weapons\evolved\_egg\battle_rifle_silent\battle_rifle_silent))
        1
    )
    (if
        (or
            (< 0.000000 (unit_get_health (player0)))
            (< 0.000000 (unit_get_health (player1)))
        )
        (begin
            (game_save_cancel)
            (object_cannot_take_damage (players))
            (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro)
            (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit)
            (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_23_sbr)
            (ai_conversation sbr_dead)
            (player_enable_input 0)
            (camera_control 1)
            (cinematic_show_letterbox 1)
            (camera_set_relative tsbr_relative 0 the_silent_battle_rifle)
            (sleep 210)
            (game_lost)
        )
    )
)


(script continuous m_exit_music_helper
    (sleep_until m_exit_music_helper_start 1)
    (if
        m_exit_music_helper_timer_on
        (if
            (> m_exit_music_helper_timer 0)
            (set m_exit_music_helper_timer (- m_exit_music_helper_timer 1.000000))
            (begin
                (set m_exit_music_phase exit_music_full)
                (sleep_forever)
            )
        )
        (if
            (< m_exit_music_helper_timer 113)
            (begin
                (set m_exit_music_helper_timer (+ m_exit_music_helper_timer 1.000000))
                (sound_looping_set_scale cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit (/ m_exit_music_helper_timer 113.000000))
            )
            (begin
                (set m_exit_music_helper_timer 450)
                (sleep_until m_exit_music_helper_timer_on)
            )
        )
    )
)


(script dormant m_exit_music
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro)
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit)
    (sound_looping_set_scale cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit 0.000000)
    (sleep_until (= m_exit_music_phase exit_music_withperc))
    (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro)
    (sleep_until (= m_exit_music_phase exit_music_perconly))
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro)
    (set m_exit_music_helper_start 1)
    (sleep_until (= m_exit_music_phase exit_music_full))
    (music_alt cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit)
    (sleep_until (= m_exit_music_phase exit_music_end))
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit)
)


(script continuous m_exit_zealot
    (sleep_until m_exit_zealot_start 1)
    (if
        (< (ai_living_count exit_zealot) 1)
        (sleep_forever)
    )
    (sleep_until
        (and
            (volume_test_players_any int_shaft_bridge)
            (volume_test_players_all int_shaft_ledge_big)
        )
        1
    )
    (ai_braindead exit_zealot 1)
    (if
        (volume_test_object
            int_shaft_bridge
            (list_get (ai_actors exit_zealot) 0)
        )
        (begin
            (ai_command_list exit_zealot exit_shaft_zealot_panel_bridge)
            (sleep 90)
            (ai_command_list exit_zealot exit_shaft_zealot_panel)
        )
        (ai_command_list exit_zealot exit_shaft_zealot_panel)
    )
    (sleep_until
        (or
            (volume_test_object
                exit_shaft_zealot_switch
                (list_get (ai_actors exit_zealot) 0)
            )
            (volume_test_object
                int_shaft_bridge
                (list_get (ai_actors exit_zealot) 0)
            )
            (not (volume_test_players_any int_shaft_bridge))
            (not (volume_test_players_all int_shaft_ledge_big))
        )
        1
        60
    )
    (ai_braindead exit_zealot 0)
    (if
        (and
            (volume_test_players_any int_shaft_bridge)
            (volume_test_players_all int_shaft_ledge_big)
            (volume_test_object
                exit_shaft_zealot_switch
                (list_get (ai_actors exit_zealot) 0)
            )
            (> (ai_living_count exit_zealot) 0)
        )
        (begin
            (device_group_set position_int_shaft_a_bridge 0.000000)
            (if
                (volume_test_players_all int_shaft_bridge)
                (ai_command_list exit_zealot exit_shaft_zealot_gloat)
            )
            (sleep 60)
        )
    )
)


(script dormant m_exit_zealot_trigger
    (sleep_until
        (or
            (= 0 (ai_living_count exit_zealot))
            (> (ai_status exit_zealot) 3)
            (volume_test_players_any int_shaft_entered)
        )
    )
    (set m_exit_zealot_start 1)
    (sleep_until
        (or
            (<
                14.000000
                (objects_distance_to_object (ai_actors exit_zealot) (player0))
            )
            (<
                14.000000
                (objects_distance_to_object (ai_actors exit_zealot) (player1))
            )
        )
    )
    (ai_defend exit_zealot)
)


(script continuous m_exit_automig
    (sleep_until m_exit_automig_start 1)
    (sleep_until
        (= bsp_index_int_shaft_b (structure_bsp_index))
        1
    )
    (ai_migrate exit_hunters_retreat/hunters exit_hunters_retreat_b/lobby)
    (sleep_until
        (= bsp_index_int_shaft_c (structure_bsp_index))
        1
    )
    (ai_migrate exit_hunters_retreat_b/hunters exit_hunters_retreat/lobby)
)


(script dormant m_exit_door_witch
    (sleep_until (volume_test_players_any int_cart_threshold) 1)
    (object_create_anew int_shaft_c_cart_door_upper)
    (device_group_change_only_once_more_set position_int_shaft_c_cart_dooru 0)
)


(script dormant m_exit_main
    (ai_erase int_cart_hunters/hack)
    (ai_migrate int_cart_hunters exit_hunters_retreat/elevator)
    (ai_migrate int_cart_hunters_side exit_hunters_retreat/elevator)
    (if
        (> (ai_living_count exit_hunters_retreat) 0)
        (begin
            (object_destroy int_shaft_c_hunter_lift)
            (object_create int_shaft_c_hunter_lift_fake)
            (skip_frame)
            (ai_teleport_to_starting_location exit_hunters_retreat)
        )
    )
    (ai_place exit_lobby)
    (ai_defend exit_lobby)
    (sleep 90)
    (objective_set dia_leave obj_leave)
    (sleep 210)
    (wake m_exit_music)
    (ai_magically_see_players exit_hunters_retreat)
    (sleep_until (volume_test_players_any int_cart_door_outer))
    (garbage_collect_now)
    (ai_place exit_lroom)
    (if
        (game_is_easy)
        (begin
            (ai_erase int_hallways_lroom)
            (ai_erase int_hallways_surprise_brootz)
            (ai_conversation int_exit_special_c_first)
        )
        (if
            (= (game_difficulty_get_real) normal)
            (begin
                (ai_erase int_hallways_lroom/brutes)
                (ai_erase int_hallways_lroom/snipers)
            )
            (if
                (= (game_difficulty_get_real) hard)
                (ai_erase int_hallways_lroom/grunts)
            )
        )
    )
    (ai_migrate exit_lroom/elite_entrance exit_lroom/retreat)
    (ai_migrate exit_lobby/grunts_retreat exit_lobby/grunts_center)
    (ai_attack exit_lobby)
    (ai_migrate exit_hunters_retreat exit_hunters_retreat/lobby)
    (game_save_no_timeout)
    (sleep_until
        (or
            (volume_test_players_any int_hallways_lobby_entrance_up)
            (volume_test_players_any int_hallways_lobby_entrance_low)
        )
    )
    (if
        (volume_test_players_any int_hallways_lobby_entrance_up)
        (begin
            (ai_migrate exit_lobby/elite exit_lobby/elite_aquarium)
            (ai_migrate exit_lobby/grunts exit_lobby/grunts_center)
            (sleep_until (not (volume_test_players_any int_hallways_lobby_entrance_up)))
            (ai_migrate exit_lobby/elite exit_lobby/elite_center)
            (sleep_until
                (or
                    (volume_test_players_any int_hallways_lobby_entrance_low)
                    (volume_test_players_any int_hallways_lobby_exit_up)
                )
            )
            (game_save_no_timeout)
            (set m_exit_music_phase exit_music_withperc)
            (ai_migrate exit_hunters_retreat exit_hunters_retreat/lroom_side)
            (ai_migrate exit_lobby/grunts exit_lroom/grunts_exit)
            (ai_migrate exit_lobby/elite exit_lroom/elite_exit)
            (if (game_is_easy) (ai_conversation int_exit_special_c_second))
            (if
                (volume_test_players_any int_hallways_lobby_entrance_low)
                (begin
                    (ai_migrate exit_lroom/jackal_balcony_alarm exit_lroom/jackals_balcony)
                    (ai_magically_see_players exit_lroom/exit)
                    (sleep_until (volume_test_players_any int_hallways_lroom_center))
                    (game_save_no_timeout)
                )
                (begin
                    (ai_magically_see_players exit_lroom)
                    (ai_migrate exit_lroom/elite_center exit_lroom/elite_entrance)
                    (ai_migrate exit_lroom/grunts_center exit_lroom/jackals_entrance)
                )
            )
        )
        (begin
            (set m_exit_music_phase exit_music_withperc)
            (ai_migrate exit_lobby/grunts exit_lroom/grunts_exit)
            (ai_migrate exit_lobby/elite exit_lroom/elite_exit)
            (ai_migrate exit_lroom/jackal_balcony_alarm exit_lroom/jackals_balcony)
            (ai_magically_see_players exit_lroom)
            (if (game_is_easy) (ai_conversation int_exit_special_c_second))
            (sleep_until
                (or
                    (volume_test_players_any int_hallways_lroom_center)
                    (volume_test_players_any int_hallways_lobby_exit_up)
                )
            )
            (game_save_no_timeout)
        )
    )
    (ai_migrate exit_lroom/retreat exit_lroom/elite_entrance)
    (ai_migrate exit_lroom/elite_exit exit_lroom/elite_center)
    (ai_migrate exit_lroom/jackals_exit exit_lroom/elite_center)
    (ai_migrate exit_lroom/grunts_exit exit_lroom/grunts_center)
    (ai_defend exit_lroom/center)
    (ai_place exit_waterhall/jackals_lower_spawn)
    (ai_place exit_waterhall/elite_mid)
    (ai_place exit_waterhall/snipers_upper)
    (ai_place exit_waterhall/jackals_upper)
    (ai_place exit_waterhall/grunts_elevator)
    (ai_place exit_waterhall/snipers_elevator)
    (ai_defend exit_waterhall)
    (if
        (game_is_easy)
        (ai_erase int_hallways_waterhall)
        (if
            (= (game_difficulty_get_real) normal)
            (begin
                (ai_erase int_hallways_waterhall/elite_upper)
                (ai_erase int_hallways_waterhall/elite_mid)
                (ai_erase int_hallways_waterhall/elite_lower)
                (ai_erase int_hallways_waterhall/jackals_mid)
            )
            (if
                (= (game_difficulty_get_real) hard)
                (begin
                    (ai_erase int_hallways_waterhall/elite_mid)
                    (ai_erase int_hallways_waterhall/jackals_mid)
                )
            )
        )
    )
    (sleep_until (volume_test_players_any int_hallways_lroom_entrance))
    (if
        (game_is_easy)
        (begin
            (ai_erase exit_waterhall)
            (ai_erase exit_lobby)
            (ai_erase exit_lroom)
            (device_set_position_immediate int_shaft_b_waterhall_door 1.000000)
            (device_set_power int_shaft_b_waterhall_door 0.000000)
        )
    )
    (game_save_no_timeout)
    (set m_exit_music_phase exit_music_perconly)
    (if
        (> (ai_living_count exit_lroom/entrance) 0)
        (ai_migrate exit_lroom/entrance exit_lroom/retreat)
        (if
            (> (ai_living_count exit_lroom/center) 0)
            (ai_migrate exit_lroom/center exit_lroom/retreat)
            (if
                (> (ai_living_count exit_lroom/exit) 0)
                (ai_migrate exit_lroom/exit exit_lroom/retreat)
            )
        )
    )
    (ai_migrate exit_waterhall/jackals_lower_spawn exit_waterhall/jackals_lower)
    (ai_command_list exit_waterhall/jackals_lower exit_hallways_jackals)
    (ai_migrate exit_lroom/entrance exit_lroom/retreat)
    (sleep_until (volume_test_players_any int_hallways_special_brootz) 1)
    (if
        (game_is_easy)
        (begin
            (sound_looping_set_scale cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro 0.000000)
            (sound_looping_set_scale cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit 0.000000)
            (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17_exit_intro)
            (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_17a_exit)
            (object_create_containing special_help)
        )
    )
    (sleep_until (volume_test_players_any int_hallways_waterhall_lower))
    (set m_exit_music_helper_timer_on 1)
    (ai_migrate exit_lroom/retreat exit_waterhall/jackals_lower)
    (ai_place exit_waterhall/elite_upper)
    (ai_attack exit_waterhall)
    (game_save_no_timeout)
    (sleep_until
        (or
            (volume_test_players_any int_hallways_waterhall_mid)
            (< (ai_living_fraction exit_waterhall) 0.500000)
        )
    )
    (if x_dbg_enabled (inspect m_exit_music_helper_timer))
    (if
        (not (game_is_easy))
        (ai_place exit_waterhall/grunts_mid)
        (ai_conversation int_exit_special_trap)
    )
    (ai_migrate exit_waterhall/grunts_mid exit_waterhall/jackals_upper)
    (ai_migrate exit_waterhall/lower exit_waterhall/grunts_mid)
    (game_save_no_timeout)
    (sleep_until
        (or
            (volume_test_players_any int_hallways_waterhall_upper)
            (< (ai_living_fraction exit_waterhall) 0.250000)
        )
    )
    (set m_exit_music_helper_timer 0)
    (if
        (not (game_is_easy))
        (ai_place exit_waterhall/elite_elevator)
    )
    (game_save_no_timeout)
    (ai_migrate exit_waterhall/jackals_upper exit_waterhall/grunts_elevator)
    (ai_migrate exit_waterhall/mid exit_waterhall/jackals_upper)
    (sleep_until (volume_test_players_any int_hallways_waterhall_entrance) 15)
    (game_save_no_timeout)
    (ai_migrate exit_waterhall/elevator exit_waterhall/snipers_elevator)
    (ai_migrate exit_waterhall/upper exit_waterhall/grunts_elevator)
    (if
        (game_is_easy)
        (begin
            (game_save_totally_unsafe)
            (object_create water_fogs_elevator)
            (device_set_position water_fogs_elevator 1.000000)
            (device_set_position lodvol_int_hallways_water_f 1.000000)
            (ai_place exit_waterhall_easy/fuck)
            (ai_place exit_waterhall_easy/you)
            (ai_set_respawn exit_waterhall_easy 1)
            (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_18_halo_1)
            (device_set_power int_shaft_b_waterhall_door 1.000000)
            (device_operates_automatically_set int_shaft_b_waterhall_door 0)
            (sleep 60)
            (object_destroy int_shaft_b_waterhall_door)
            (object_create int_shaft_b_waterhall_door_bsh)
            (sleep 300)
            (ai_conversation int_exit_special_how_get_out)
            (sleep 600)
            (ai_place exit_waterhall_easy/hce)
            (ai_defend exit_waterhall_easy)
            (device_set_position int_shaft_b_waterhall_door_bsh 1.000000)
            (ai_conversation int_exit_special_what's_that)
            (sleep 90)
            (ai_conversation int_exit_special_get_up)
        )
    )
    (sleep_until (volume_test_players_any int_elevator_descending))
    (set m_exit_music_phase exit_music_end)
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_18_halo_1)
    (ai_set_respawn exit_waterhall_easy 0)
    (ai_kill marines_int_shaft_a)
    (ai_kill marines_ext_capp-cart)
    (ai_place exit_zealot)
    (skip_second)
    (if
        (game_is_easy)
        (begin
            (ai_kill exit_zealot)
            (ai_conversation int_exit_special_mystery)
        )
    )
    (sleep_until (volume_test_players_any int_shaft_bridge))
    (game_save_no_timeout)
    (wake m_exit_zealot_trigger)
    (sleep_until (volume_test_players_any ext_cart_smallgorge))
    (music_stop cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_19_surface)
)


(script dormant m_exit_secret_end
    (sleep_until (volume_test_players_any ext_cart_entrance_past))
    (game_save_totally_unsafe)
    (object_create_containing satan)
    (object_set_scale satan_huge 5.000000 0)
    (object_set_scale satan_huge2 10.000000 0)
    (object_set_scale satan_huge3 15.000000 0)
    (phantom_of_the_map)
    (player_effect_rumble)
    (skip_frame)
    (physics_set_gravity 1.000000)
    (sleep_until (volume_test_players_any ext_cart_main))
    (player_effect_rumble)
    (ai_conversation int_exit_special_captain)
    (activate_team_nav_point_flag satan player satan_hud 0.000000)
    (ai_place exit_keyesmen)
    (ai_magically_see_players exit_keyesmen)
    (sleep_until
        (>=
            5.000000
            (objects_distance_to_object (players) satan00)
        )
    )
    (sleep_until
        (or
            (and
                (>=
                    5.000000
                    (objects_distance_to_object (player0) satan00)
                )
                (>=
                    5.000000
                    (objects_distance_to_object (player1) satan00)
                )
            )
            (<
                30.000000
                (objects_distance_to_object (players) satan00)
            )
        )
        30
        150
    )
    (physics_set_gravity -1.000000)
    (damage_object cmt\globals\_shared\damage_effects\impulse (player0))
    (damage_object cmt\globals\_shared\damage_effects\impulse (player1))
    (sleep 180)
    (unit_kill (player0))
    (unit_kill (player1))
    (map_reset)
)


(script dormant m_exit_end
    (sleep_until (volume_test_players_any ext_cart_entrance_hall))
    (music_start cmt\sounds\music\scenarios\b30_revamp\main\b30_revamp_19_surface)
    (if
        (not (game_is_easy))
        (ai_place exit_stealth_elites)
    )
    (if
        (game_is_easy)
        (ai_conversation evac_special)
        (ai_conversation evac_1)
    )
    (if
        (not (game_is_easy))
        (begin
            (create_ext_cart_cship)
            (object_teleport ext_cart_cship exit_cart_cship_flag)
            (vehicle_hover ext_cart_cship 1)
        )
    )
    (sleep_until (volume_test_players_any ext_cart_entrance_past))
    (ai_migrate exit_stealth_elites/outside exit_stealth_elites/inside)
    (ai_magically_see_players exit_stealth_elites)
    (game_save_no_timeout)
    (if (game_is_easy) (sleep_forever))
    (sleep (random_range 80 200))
    (create_insertion_pelican_1)
    (unit_close insertion_pelican_1)
    (object_cannot_take_damage insertion_pelican_1)
    (object_teleport insertion_pelican_1 extraction_pelican_flag)
    (recording_play_and_hover insertion_pelican_1 extraction_pelican_in)
    (vehicle_hover ext_cart_cship 0)
    (recording_play_and_delete ext_cart_cship exit_cart_cship_out)
    (sleep_until
        (< (recording_time insertion_pelican_1) 61)
        1
    )
    (unit_open insertion_pelican_1)
    (unit_set_enterable_by_player insertion_pelican_1 1)
    (sleep_until
        (= (recording_time insertion_pelican_1) 0)
        1
    )
    (custom_animation insertion_pelican_1 cmt\vehicles\_shared\pelican\pelican "stand fixed idle" 1)
    (sleep_until
        (or
            (vehicle_test_seat insertion_pelican_1 p-riderlf (player0))
            (vehicle_test_seat insertion_pelican_1 p-riderrf (player0))
        )
    )
    (if
        (game_is_cooperative)
        (sleep_until
            (and
                (vehicle_test_seat_list insertion_pelican_1 p-riderlf (players))
                (vehicle_test_seat_list insertion_pelican_1 p-riderrf (players))
            )
        )
    )
    (wake m_exit_cutscene_extraction)
)


(script static void m_exit_launch
    (checkpoint_launch bsp_index_int_shaft_c m_exit_spawn_0 m_exit_spawn_1)
    (if
        (game_is_easy)
        (begin
            (player_add_equipment (player0) checkpoint_easy_silent 1)
            (player_add_equipment (player1) checkpoint_easy 1)
        )
    )
)


(script static void m_exit_start
    (if
        (= b30r_launch_exit mission_launch_index)
        (m_exit_launch)
    )
    (wake m_exit_main)
    (set m_exit_automig_start 1)
    (wake m_exit_door_witch)
    (wake m_exit_end)
    (if
        (game_is_easy)
        (begin
            (wake m_exit_secret_end)
            (wake m_exit_secret_cutscene)
        )
    )
    (device_set_power int_shaft_b_lobby_door 1.000000)
    (device_set_position_immediate int_shaft_b_lobby_door 0.000000)
)


(script static void m_exit_skip
    (set mission_state mission_extracted)
    (device_group_set_immediate position_int_shaft_a_elevator 0.000000)
)


(script dormant m_exit_control
    (if
        (!= m_exit_ctrl_state 1)
        (m_exit_skip)
        (m_exit_start)
    )
    (sleep_until (>= m_exit_ctrl_state 3))
)


(script static void m_exit_startup
    (if
        (= 0 m_exit_ctrl_state)
        (begin
            (set m_exit_ctrl_state 1)
            (wake m_exit_control)
        )
    )
)


(script static void m_exit_cleanup
    (set m_exit_ctrl_state 3)
)


(script static void m_exit_mark_skip
    (m_exit_startup)
    (set m_exit_ctrl_state 2)
)

